var app=angular.module("zmf",["ngRoute","ngCookies","angucomplete-alt","ngMeta","720kb.tooltips","angular.filter","angulartics","angulartics.google.analytics"]);app.constant("config",{BASE_HOST:"https://coin.zerodha.com/",MF_JSON_HOST:"https://coin.zerodha.com/json/mf_data.js",MF_API_SERVER:"https://coin.zerodha.com/api/",TAX_FUND_CODE:"14057817.00206600",WEALTH_FUND_CODE:"14057722.00206600",SHORT_FUND_CODE:"14058085.00206600",REDEMPTION_FILES_PATH:"https://coin.zerodha.com/csv/redemption_files/",ORDER_FILES_PATH:"https://coin.zerodha.com/csv/bulk_orders_files/",LEDGER_FILES_PATH:"https://coin.zerodha.com/csv/ledger_files/",REDEMPTION_LEDGER_PATH:"https://coin.zerodha.com/csv/redeem_ledger_path/",PAYMENT_REJECTION_PATH:"https://coin.zerodha.com/csv/rejection_files/",TAX_STATEMENTS_PATH:"https://coin.zerodha.com/tax_reports/",KITE_CONNECT_APIKEY:"5q84nbae9ex2bguk",LOGIN_ENABLED:!0,SIP_ENABLED:!1}),app.run(["$route","config","$rootScope","SearchService","$location","$window","$routeParams","$cookies","ngMeta","KiteAuthService","SubscriptionServices",function(e,t,n,a,r,i,o,s,l,c,d){n.TEST_MODE=!1,n.BASE_HOST=t.BASE_HOST,n.MF_JSON_HOST=t.MF_JSON_HOST,n.SERVICE_HOST=t.SERVICE_HOST,n.MF_API_SERVER=t.MF_API_SERVER,n.PULSE_FEED=t.PULSE_FEED,n.VARSITY_FEED=t.VARSITY_FEED,n.TAX_FUND_CODE=t.TAX_FUND_CODE,n.WEALTH_FUND_CODE=t.WEALTH_FUND_CODE,n.SHORT_FUND_CODE=t.SHORT_FUND_CODE,n.LOGIN_ENABLED=t.LOGIN_ENABLED,n.SIP_ENABLED=t.SIP_ENABLED,n.REDEMPTION_FILES_PATH=t.REDEMPTION_FILES_PATH,n.ORDER_FILES_PATH=t.ORDER_FILES_PATH,n.LEDGER_FILES_PATH=t.LEDGER_FILES_PATH,n.REDEMPTION_LEDGER_PATH=t.REDEMPTION_LEDGER_PATH,n.PAYMENT_REJECTION_PATH=t.PAYMENT_REJECTION_PATH,n.KITE_CONNECT_APIKEY=t.KITE_CONNECT_APIKEY,n.TAX_STATEMENTS_PATH=t.TAX_STATEMENTS_PATH,n.client_loggedIn=!1,n.partner_loggedIn=!1,n.loading=!1,n.is_admin=!1,n.ServerStatus=!0,n.directSeenFlag=!0;var u=r.path;r.path=function(t,a){if(a===!1)var i=e.current,o=n.$on("$locationChangeSuccess",function(){e.current=i,o()});return u.apply(r,[t])},n.$on("$routeChangeSuccess",function(){if(e.current.title&&(i.document.title=e.current.title),n.client_loggedIn=!1,n.partner_loggedIn=!1,s.get("session_token")){var t=s.get("session_token");0===t.lastIndexOf("ptnr_",0)?n.partner_loggedIn=!0:n.client_loggedIn=!0}else n.client_loggedIn=!1,n.partner_loggedIn=!1,n.directSeenFlag=!0,n.login_redirect_url=r.path()});var _=r.search();if(void 0!==_.utm_source){var p=_.utm_source.replace(/[^a-z0-9]/gi,"");if(void 0===s.get("utm_source")&&p.length<15){var m=new Date;m.setDate(m.getDate()+2),s.put("utm_source",_.utm_source,{expires:m})}}l.init(),n.checkBlur=function(){n.directSeenFlag&&(n.blur=!1)},n.directNoticeSeen=function(){n.loading=!0,s.get("session_token")?d.directNoticeSeen(s.get("session_token")).then(function(e){1==e.data?c.client_details(s.get("session_token")).then(function(e){e.data.client_details.direct_notice_seen&&(n.directSeenFlag=!0,n.blur=!1)}):c.client_details(s.get("session_token")).then(function(e){e.data.client_details.direct_notice_seen&&(n.directSeenFlag=!0,n.blur=!1)})}):n.directSeenFlag=!0}}]),app.config(["$routeProvider","$compileProvider","$locationProvider","ngMetaProvider",function(e,t,n,a){t.debugInfoEnabled(!1),n.html5Mode(!0),e.when("/",{templateUrl:"views/index.html",title:"Coin by Zerodha - Buy and sell thousands of commission-free direct mutual funds in seconds"}).when("/home",{templateUrl:"views/index.html",title:"Coin by Zerodha - Buy and sell thousands of commission-free direct mutual funds in seconds"}).when("/funds",{templateUrl:"views/funds.html",controller:"FundsCtrl",title:"Coin by Zerodha - Buy and sell thousands of commission-free direct mutual funds in seconds"}).when("/funds/screener",{templateUrl:"views/screener.html",controller:"ScreenerCtrl",title:"Coin by Zerodha - Buy and sell thousands of commission-free direct mutual funds in seconds"}).when("/funds/non-direct",{templateUrl:"views/funds_regular.html",controller:"FundsRegularCtrl",title:"Coin by Zerodha - Buy and sell thousands of commission-free direct mutual funds in seconds"}).when("/funds/:id/:slug?",{templateUrl:"views/description.html",controller:"DescriptionCtrl",title:"Coin by Zerodha"}).when("/category/:categoryType",{templateUrl:"views/category.html",controller:"CategoryCtrl",title:"Coin by Zerodha - Categories"}).when("/compare/:id1?/:id2?/:id3?",{templateUrl:"views/compare.html",controller:"compareCtrl",title:"Compare Funds - Coin by Zerodha"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",title:"Login - Coin by Zerodha"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl",title:"Logout - Coin by Zerodha"}).when("/auth",{templateUrl:"views/validate.html",controller:"AuthCtrl",title:"Login Validation - Coin by Zerodha"}).when("/partner_dashboard",{templateUrl:"views/partner_dashboard.html",controller:"PartnerDashboardCtrl",title:"Partner Dashboard - Coin by Zerodha"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",title:"Dashboard - Coin by Zerodha"}).when("/dashboard/orderhistory",{templateUrl:"views/orderhistory.html",controller:"OrderHistoryCtrl",title:"Order History - Coin by Zerodha"}).when("/dashboard/sip",{templateUrl:"views/sip.html",controller:"SipCtrl",title:"SIP details - Coin by Zerodha"}).when("/fatca",{templateUrl:"views/fatca.html",controller:"FatcaCtrl",title:"FATCA Registration - Coin by Zerodha"}).when("/faq",{templateUrl:"views/faq.html",controller:"FaqCtrl",title:"FAQs - Coin by Zerodha"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl",title:"Admin Panel - Coin by Zerodha"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl",title:"Account - Coin by Zerodha"}).when("/quicklogin",{templateUrl:"views/quicklogin.html",controller:"QuickLoginCtrl",title:"Dashboard - Coin by Zerodha"}).when("/404",{templateUrl:"views/404.html",title:"Coin by Zerodha - Page not found"}).otherwise({redirectTo:"/404",title:"Coin by Zerodha - Page not found"})}]),app.service("AddLead",["$http","$window","$rootScope","HTTPFactory",function(e,t,n,a){this.addLead=function(e,t,r,i){var o=n.MF_API_SERVER+"add_zlm_lead",s={name:e,email:t,phone:r,partner_id:i};return n.loading=!0,a.postAndGetResults(o,s).then(function(e){return n.loading=!1,e})},this.addLeadZerodhaCom=function(e,t,r,i){var o="https://zerodha.com/account/registration.php",s={name:e,email:t,mobile:r,partner:i,referral:"zerodha_coin",source:"zerodha_coin",subject:"Coin by Zerodha - Online Application",language:"English"};return n.loading=!0,a.postAndGetResults(o,s).then(function(e){return n.loading=!1,e})}}]),app.service("compareService",function(){}),app.service("DashboardDetails",["$http","$window","$rootScope","HTTPFactory",function(e,t,n,a){this.getDetails=function(e){var t=n.MF_API_SERVER+"dashboard_details",r={session_token:e};return n.loading=!0,a.getInfo(t,r).then(function(e){return n.loading=!1,e})},this.getSparkline=function(e,t){var r=n.MF_API_SERVER+"sparkline_data",i={session_token:e,scheme_id:t};return n.loading=!0,a.getInfo(r,i).then(function(e){return n.loading=!1,e})},this.sipDetails=function(e){var t=n.MF_API_SERVER+"sip_details",r={session_token:e};return n.loading=!0,a.getInfo(t,r).then(function(e){return n.loading=!1,e})},this.orderHistory=function(e){var t=n.MF_API_SERVER+"order_history",r={session_token:e};return n.loading=!0,a.getInfo(t,r).then(function(e){return n.loading=!1,e})},this.portfolioDetails=function(e){var t=n.MF_API_SERVER+"portfolio",r={session_token:e};return n.loading=!0,a.getInfo(t,r).then(function(e){return n.loading=!1,e})},this.sipEdit=function(e){var t=n.MF_API_SERVER+"edit_sip",r=e;return a.postAndGetResults(t,r).then(function(e){return e})},this.sip_status_update=function(e){var t=n.MF_API_SERVER+"sip_status_update",r=e;return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})},this.sip_delete=function(e){var t=n.MF_API_SERVER+"sip_delete",r=e;return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})},this.reOrder=function(e){var t=n.MF_API_SERVER+"reorder",r=e;return a.postAndGetResults(t,r).then(function(e){return e})}}]),app.service("fileUpload",["$http","$rootScope","$cookies",function(e,t,n){this.uploadFileToUrl=function(a,r){t.loading=!0,t.blur=!0;var i=new FormData;return token=n.get("session_token"),i.append("infile",a),i.append("session_token",token),e.post(r,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){return t.loading=!1,t.blur=!1,"success"==e.status?e.status=200:e.status=!1,e}).error(function(){t.loading=!1,t.blur=!1,alert("Upload Failed")})}}]),app.service("KiteAuthService",["$http","$window","$rootScope","HTTPFactory","$cookies",function(e,t,n,a,r){n.auth_url="https://kite.trade/connect/login?api_key="+n.KITE_CONNECT_APIKEY,this.authenticate=function(e){var t=n.MF_API_SERVER+"kite_login",r={request_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})},this.logout=function(e){if(void 0!==e){var t=n.MF_API_SERVER+"kite_logout",r={session_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})}return!1},this.client_details=function(e){if(void 0!==e){var t=n.MF_API_SERVER+"client_details",r={session_token:e};return n.loading=!0,a.getInfo(t,r).then(function(e){return n.loading=!1,e})}return!1},this.checkAdmin=function(e){var t=n.MF_API_SERVER+"check_admin",r={session_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return e})},this.get_balance=function(e){var t=n.MF_API_SERVER+"kite_balance",r={session_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return e})}}]),app.service("mfService",["HTTPFactory","$rootScope","$cookies",function(e,t,n){var a="",r="",i="";this.setMfId=function(e){a=e},this.setMfName=function(e){r=e},this.setSearchName=function(e){i=e},this.getMfId=function(){return a},this.getMfName=function(){return r},this.getSearchName=function(){return i},this.getMFInfo=function(a,r){var i=t.MF_API_SERVER+"fund-info";if(n.get("session_token"))var o={scheme_id:a,graph_type:r,session_token:n.get("session_token")};else var o={scheme_id:a,graph_type:r,session_token:""};return t.loading=!0,e.getInfo(i,o).then(function(e){return t.loading=!1,e})},this.getTopMFInfo=function(n,a){var r=t.MF_API_SERVER+"topfunds",i={category_type:n,mf_count:a};return t.loading=!0,e.getInfo(r,i).then(function(e){return t.loading=!1,e})}}]),app.service("OrderService",["$rootScope","HTTPFactory","$window","$cookies",function(e,t,n,a){this.fatcaRegistration=function(n){var a=e.MF_API_SERVER+"fatca_registration",r=n;return e.loading=!0,t.postAndGetResults(a,r).then(function(t){return e.loading=!1,t})},this.getTaxStatement=function(n,a){var r=e.MF_API_SERVER+"tax_statement",i={session_token:n,year:a};return e.loading=!0,t.getInfo(r,i).then(function(t){return e.loading=!1,t})},this.sendOrder=function(n){var a=e.MF_API_SERVER+"orderprocess",r=n;return e.loading=!0,t.postAndGetResults(a,r).then(function(t){return e.loading=!1,t})},this.deleteOrder=function(n,r,i){var o=a.get("session_token"),s=e.MF_API_SERVER+"delete_order",l={session_token:o,order_id:n,purchase_type:r,bse_code:i};return e.loading=!0,t.postAndGetResults(s,l).then(function(t){return e.loading=!1,t})}}]),app.service("PartnerService",["$http","$window","$rootScope","HTTPFactory","$cookies",function(e,t,n,a,r){this.authenticate=function(e,t){var r=n.MF_API_SERVER+"partner_login",i={partner_id:e,partner_password:t};return n.loading=!0,a.postAndGetResults(r,i).then(function(e){return n.loading=!1,e})},this.logout=function(e){var t=n.MF_API_SERVER+"partner_logout",r={session_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})},this.partner_client_mapcheck=function(e,t){var r=n.MF_API_SERVER+"partner_client_mapcheck",i={session_token:t,client_id:e};return n.loading=!0,a.postAndGetResults(r,i).then(function(e){return n.loading=!1,e})},this.partner_client_scheme_statuscheck=function(e,t,r){var i=n.MF_API_SERVER+"partner_client_scheme_statuscheck",o={session_token:r,client_id:e,scheme_id:t};return n.loading=!0,a.postAndGetResults(i,o).then(function(e){return n.loading=!1,e})},this.sendOrder=function(e){var t=n.MF_API_SERVER+"partner_order",r=e;return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})},this.dashboard=function(e){var t=n.MF_API_SERVER+"partner_dashboard",r={session_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})}}]),app.service("QAuthService",["$http","$window","$q","$rootScope","HTTPFactory","$cookies",function(e,t,n,a,r,i){this.validateUser=function(e,t){var n=a.MF_API_SERVER+"check_clientid",i={client_id:e,token:t};return a.loading=!0,r.postAndGetResults(n,i).then(function(e){return a.loading=!1,e})},this.checkAdmin=function(e,t){var n=a.MF_API_SERVER+"check_admin",i={client_id:e,token:t};return a.loading=!0,r.postAndGetResults(n,i).then(function(e){return e})},this.authenticate=function(t){i.put("authRedirect",t),a.loading=!0,a.auth_fail=!1,e({url:a.MF_API_SERVER+"qauthenticate",method:"GET"}).success(function(e,t,n,r){i.put("authToken",e.data),200==e.status?(0!=e.data?a.auth_url="https://q.zerodha.com/qconnect/auth?client_id=zmf&token="+e.data:a.auth_url=!1,a.loading=!1):(a.auth_url=!1,a.auth_fail=!0,a.loading=!1)}).error(function(e,t,n,r){a.loading=!1})},this.validateKey=function(t,n){return e({url:a.MF_API_SERVER+"validateqlogin",method:"GET",params:{hash_value:t,token:n}})},this.setUserSession=function(e,t,n){var i=a.MF_API_SERVER+"createsession",o={api_key:e,client_id:t,api_hash:n};return a.loading=!0,r.postAndGetResults(i,o).then(function(e){return a.loading=!1,e})},this.logout=function(t,n){return void 0!=t&&void 0!=n&&e({url:a.MF_API_SERVER+"destroysession",method:"GET",params:{api_key:t,client_id:n}})}}]),app.service("SearchService",["$rootScope","HTTPFactory",function(e,t){this.getMutualFunds=function(){var n=e.SERVICE_HOST+"scheme-master";return t.getInfo(n).then(function(e){return e.data})},this.getMFList=function(){return JSON.parse(autoCompleteData)},this.getLandPageData=function(){var n=e.GRAPH_JSON_HOST;return t.getData(n)}}]),app.service("SubscriptionServices",["$http","$window","$rootScope","HTTPFactory",function(e,t,n,a){this.unsubscribe=function(e){var t=n.MF_API_SERVER+"direct_unsubscribe",r={session_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})},this.directNoticeSeen=function(e){var t=n.MF_API_SERVER+"direct_notice_seen",r={session_token:e};return n.loading=!0,a.postAndGetResults(t,r).then(function(e){return n.loading=!1,e})}}]),app.service("utilService",function(){this.generateSlug=function(e){return e.toLowerCase().match(/[a-z0-9]{4,}/gi).join("-")}}),app.controller("AccountCtrl",["$scope","$rootScope","$location","$window","$route","$cookies","KiteAuthService","SubscriptionServices",function(e,t,n,a,r,i,o,s){function l(){t.loading=!0,e.client=[],o.client_details(i.get("session_token")).then(function(n){0!=n.data.client_details&&(e.client.investor_name=n.data.client_details.name,e.client.email=n.data.client_details.email,e.client.mobile=n.data.client_details.mobile,e.client.pan=n.data.client_details.pan,e.client.direct_subscription=n.data.client_details.direct_subscription,e.client.equity_balance=n.data.client_details.equity_balance,e.client.direct_notice_seen=n.data.client_details.direct_notice_seen,t.directSeenFlag=n.data.client_details.direct_notice_seen,t.directSeenFlag||(t.blur=!0),t.loading=!1)})}e.unsubscribeModal=!1,e.unsubscribeStep=0,t.blur=!1,e.login=function(){i.put("authRedirect",n.absUrl()),a.location.replace(t.BASE_HOST+"login")},e.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.client_loggedIn?(t.client_id=i.get("client_id"),t.client_name=i.get("client_name").split(" ")[0],l()):e.login(),e.showUnsubscribe=function(n){1==n?(e.unsubscribeModal=!0,e.unsubscribeStep=1,t.blur=!0):2==n&&(t.loading=!0,e.unsubscribeStep=2,s.unsubscribe(i.get("session_token")).then(function(t){1==t.data?(e.unsubscribeStatus=!0,l()):(e.unsubscribeStatus=!1,l())}))},e.closeModal=function(){e.unsubscribeModal=!1,e.unsubscribeStep=0,t.blur=!1},t.$watch("blur",function(){0==t.blur&&e.closeModal()})}]),app.controller("AdminCtrl",["$rootScope","$scope","HTTPFactory","$http","fileUpload","$cookies","KiteAuthService","utilService","$filter",function(e,t,n,a,r,i,o,s,l){t.user_status=!1,t.orders_overview=!0,t.client_details=!1,t.admin_tools=!1,t.itemsPerPage=10,t.currentPage=0,t.items=[],t.portfolio_table=!0,t.orderHistory=!1,t.sip_table=!1,t.client_check_msg="",t.OrdersOrderBy="ordered_at",t.OrdersOrderSort=!0,t.divReinvestModel=!1,t.divReinvestStep=0,t.closeModal=function(){t.divReinvestModel=!1,t.divReinvestStep=0,e.blur=!1},e.$watch("blur",function(){0==e.blur&&t.closeModal()}),t.showDivReinvestModal=function(){t.divReinvestModel=!0,t.divReinvestStep=1,e.blur=!0},t.addDivReinvest=function(a,r,o,s,l,c){if(1==c)t.divreinvest_order_obj={client_id:a.toUpperCase(),units:r,date:o,bse_scheme_code:s,nav:l,session_token:i.get("session_token")},t.divReinvestStep=2;else if(2==c){var d=e.MF_API_SERVER+"add_div_reinvest",u=t.divreinvest_order_obj;e.loading=!0,n.postAndGetResults(d,u).then(function(n){e.loading=!1,t.divreinvest_status_msg=n.message,t.divReinvestStep=3})}},t.numberOfPages=function(){return Math.ceil(t.client_details_data.order_history.length/t.itemsPerPage)},t.setPage=function(e){t.currentPage=e},t.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.getData=function(a){e.client_loggedIn?(e.loading=!0,o.checkAdmin(i.get("session_token")).then(function(r){if(0==r.data)e.is_admin=!1,window.location.replace(e.BASE_HOST+"dashboard");else if(e.loading=!1,e.is_admin=!0,e.super_admin=!1,e.is_support=!1,e.client_id=r.data.client_id,"admin"==r.data.role){e.super_admin=!0;var o=e.MF_API_SERVER+"orders_overview",s={session_token:i.get("session_token")};if("refresh"==a){e.loading=!0,n.getInfo(o,s).then(function(n){e.loading=!1,200==n.status&&(t.orders_overview_data=n.data)});var o=e.MF_API_SERVER+"amc_details",s={session_token:i.get("session_token")};e.loading=!0,n.getInfo(o,s).then(function(n){e.loading=!1,200==n.status&&(t.amc_details_data=n)})}}else"support"==r.data.role&&(e.is_support=!0,t.orders_overview=!1,t.settlement_wise=!1,t.client_details=!0,t.amc_details=!1,t.admin_tools=!1)})):window.location.replace(e.BASE_HOST+"dashboard")},t.getSettlementData=function(a){e.client_loggedIn?(e.loading=!0,t.bse_order_id=!1,o.checkAdmin(i.get("session_token")).then(function(r){if(0==r.data)e.is_admin=!1,window.location.replace(e.BASE_HOST+"dashboard");else{e.loading=!1,e.is_admin=!0;var o=e.MF_API_SERVER+"orders_overview",s={session_token:i.get("session_token"),settlement_number:a};e.loading=!0,n.getInfo(o,s).then(function(n){e.loading=!1,200==n.status&&(t.settlement_overview_data=n.data)})}})):window.location.replace(e.BASE_HOST+"dashboard")},t.getBseOrderId=function(a){e.client_loggedIn?(t.settlement_overview_data=!1,e.loading=!0,o.checkAdmin(i.get("session_token")).then(function(r){if(0==r.data)e.is_admin=!1,window.location.replace(e.BASE_HOST+"dashboard");else{e.loading=!1,e.is_admin=!0;var o=e.MF_API_SERVER+"orders_overview",s={session_token:i.get("session_token"),order_id:a};e.loading=!0,n.getInfo(o,s).then(function(n){e.loading=!1,200==n.status&&(t.bse_order_id=n.data.order_details)})}})):window.location.replace(e.BASE_HOST+"dashboard")},t.getData(),t.switchPanel=function(e){1==e?(t.orders_overview=!0,t.settlement_wise=!1,t.client_details=!1,t.amc_details=!1,t.admin_tools=!1):2==e?(t.orders_overview=!1,t.settlement_wise=!0,t.client_details=!1,t.amc_details=!1,t.admin_tools=!1):3==e?(t.orders_overview=!1,t.settlement_wise=!1,t.client_details=!0,t.amc_details=!1,t.admin_tools=!1):4==e?(t.orders_overview=!1,t.settlement_wise=!1,t.client_details=!1,t.amc_details=!0,t.admin_tools=!1):5==e&&(t.orders_overview=!1,t.settlement_wise=!1,t.client_details=!1,t.amc_details=!1,t.admin_tools=!0)},t.client_details_tab=function(e){switch(e){case 1:t.portfolio_table=!0,t.orderHistory=!1,t.sip_table=!1;break;case 2:t.portfolio_table=!1,t.orderHistory=!1,t.sip_table=!0;break;case 3:t.portfolio_table=!1,t.orderHistory=!0,t.sip_table=!1}},t.login=function(){$window.sessionStorage.authRedirect=$location.absUrl(),i.put("authRedirect",$location.absUrl()),$window.location.replace(e.BASE_HOST+"login")},t.generateReport=function(){e.loading=!0;var a=e.MF_API_SERVER+"generate_bulkorder",r={session_token:i.get("session_token")};e.loading=!0,n.postAndGetResults(a,r).then(function(n){e.loading=!1,200==n.status?(data_obj=n.data,t.orders_list=n.data,t.order_file_status=n.status):alert(n.message)})},t.getZLMDetails=function(a){e.loading=!0;var r=e.MF_API_SERVER+"users_zlm_details",o={session_token:i.get("session_token"),client_list:a};e.loading=!0,n.postAndGetResults(r,o).then(function(n){e.loading=!1,200==n.status?(data_obj=n.data,t.user_file=data_obj,alert(n.message)):alert(n.message)})},t.getZLMDetailsQuarterly=function(a){e.loading=!0;var r=e.MF_API_SERVER+"users_zlm_details_general",o={session_token:i.get("session_token"),client_list:a};e.loading=!0,n.postAndGetResults(r,o).then(function(n){e.loading=!1,200==n.status?(data_obj=n.data,t.user_file=data_obj,alert(n.message)):alert(n.message)})},t.clientDetails=function(a){e.loading=!0,t.client_details_data="",a=a.toUpperCase();var r=e.MF_API_SERVER+"client_dashboard",o={session_token:i.get("session_token"),client_id:a};n.postAndGetResults(r,o).then(function(n){e.loading=!1,200==n.status?(t.client_details_data=n.data,t.client_details_data.sip_details=t.getSIPData(t.client_details_data.sip_details),t.client_details_data.order_history.sort(function(e,t){return new Date(t.ordered_at)-new Date(e.ordered_at)}),t.client_qbalance=t.client_details_data.qbalance,t.client_balance_updated_on=t.client_details_data.balance_updated_on,t.user_status=!0):400==n.status&&(t.user_status=!1,t.client_check_msg="Client account not enabled. Either non CDSL or non valid client ID. Check his account in ZPIN. If new user, it could take upto 2 days to be MF enabled")})},t.getSIPData=function(e){for(var t=0;t<e.length;t++)0==e[t].preferred_date&&"Once"!=e[t].frequency?e[t].next_instalment=l("custom_date_add")(e[t].frequency,e[t].last_sip_at):0!=e[t].preferred_date&&"Once"!=e[t].frequency?e[t].next_instalment=l("custom_date_add")(e[t].preferred_date,e[t].last_sip_at):"Once"==e[t].frequency&&(e[t].next_instalment="N/A");return e},t.generateCsv=function(e,t){var n="object"!=typeof e?JSON.parse(e):e,a="data:text/csv;charset=utf-8,";if("pending"==t)var r="client_id,bse_scheme_code,scheme_name,plan,transaction_mode,ordered_at,folio_number,div_reinvestment_flag,amount,units,nav,status,remarks\r\n",i=["client_id","bse_scheme_code","name","plan","transaction_mode","ordered_at","folio_number","div_reinvestment_flag","amount","units","nav","status","remarks"];else if("processing"==t)var r="client_id,bse_scheme_code,scheme_name,plan,transaction_mode,ordered_at,folio_number,div_reinvestment_flag,bse_order_number,settlement_number,amount,units,nav,status,remarks\r\n",i=["client_id","bse_scheme_code","name","plan","transaction_mode","ordered_at","folio_number","div_reinvestment_flag","order_id","settlement_id","amount","units","nav","status","remarks"];for(var o=0;o<n.length;o++){for(var s="",l=0;l<i.length;l++)index=i[l],""!=s&&(s+=","),s+="transaction_mode"==index?"P"==n[o][index]?"BUY":"SELL":n[o][index]?n[o][index]:"";r+=s+"\r\n"}var c=encodeURI(a+r),d=document.createElement("a");d.setAttribute("href",c),"pending"==t?d.setAttribute("download","coin_pending_orders.csv"):"processing"==t&&d.setAttribute("download","coin_under_processing.csv"),document.body.appendChild(d),d.click()},t.getSchemeMaster=function(t){var n=e.MF_API_SERVER+"process_schememaster",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split("|");43==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):alert("Upload Failed")}):alert("Wrong file format")}},t.fundPayout=function(n){var a=e.MF_API_SERVER+"process_fundpayout",i=n,o=new FileReader;o.readAsBinaryString(i),o.onloadend=function(){for(var n=o.result.split(/\r\n|\n/),s=0,l=0,c=0;c<n.length-1;c++){var d=n[c].split("|");22==d.length?s++:l++}0==l&&0!=s?r.uploadFileToUrl(i,a).then(function(n){d=n.data,200==d.status?(alert("Upload Success"),t.redemptionLedgerFile=d.data,0!=t.redemptionLedgerFile?(t.redemptionLedgerFilePath=e.REDEMPTION_LEDGER_PATH+t.redemptionLedgerFile,t.redemptionLedgerFile=!0):(alert(d.message),t.redemptionLedgerFile=!1)):alert("Upload Failed")}):alert("Wrong file format")}},t.orderStatus=function(t){var n=e.MF_API_SERVER+"process_orderstatus",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-2;s++){var l=e[s].split("|");36==l.length&&"PROVISIONAL ORDER~"!=l[18]?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):alert("Upload Failed")}):alert("Wrong file format")}},t.allotmentStatement=function(t){var n=e.MF_API_SERVER+"process_allotmentstatement",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split("|");35==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):alert("Upload Failed")}):alert("Wrong file format")}},t.bulkOrdersUpload=function(t){var n=e.MF_API_SERVER+"process_ordersupload",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split(",");12==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):alert("Upload Failed")}):alert("Wrong file format")}},t.redemptionStatement=function(t){var n=e.MF_API_SERVER+"process_redemptionstatement",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split("|");29==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):401==l.status?alert("Invalid User"):alert("Upload Failed")}):alert("Wrong file format")}},t.spreadOrderStatement=function(t){var n=e.MF_API_SERVER+"process_spreadstatement",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split(",");6==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):401==l.status?alert("Invalid User"):alert("Upload Failed")}):alert("Wrong file format")}},t.settlementCalendar=function(t){var n=e.MF_API_SERVER+"process_settlementcalendar",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split("|");8==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):401==l.status?alert("Invalid User"):alert("Upload Failed")}):alert("Wrong file format")}},t.payInData=function(t){var n=e.MF_API_SERVER+"process_payincsv",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split(",");2==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):401==l.status?alert("Invalid User"):alert("Upload Failed")}):alert("Wrong file format")}},t.provisionalStatus=function(t){var n=e.MF_API_SERVER+"process_provisionalstatus",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var a=i.result.split(/\r\n|\n/),o=0,s=0,l=0;l<a.length-2;l++){var c=a[l].split("|");36==c.length&&c[18].indexOf("PROVISIONAL ORDER")!==-1?o++:s++}0==s&&0!=o?r.uploadFileToUrl(t,n).then(function(t){c=t.data,200==c.status?(alert("Upload Success"),1==c.data.status&&(e.cdsl_file=c.data.cdsl_file_path,e.nsdl_file=c.data.nsdl_file_path)):401==c.status?alert("Invalid User"):alert("Upload Failed")}):alert("Wrong file format")}},t.userUploads=function(t){var n=e.MF_API_SERVER+"process_useruploads",a=t,i=new FileReader;i.readAsBinaryString(a),i.onloadend=function(){for(var e=i.result.split(/\r\n|\n/),a=0,o=0,s=0;s<e.length-1;s++){var l=e[s].split("|");75==l.length?a++:o++}0==o&&0!=a?r.uploadFileToUrl(t,n).then(function(e){l=e.data,200==l.status?alert("Upload Success"):alert("Something went wrong")}):alert("Wrong file format")}},t.info_click=[],t.showSubTable=function(e){if(void 0==t.info_click[e]&&(t.info_click[e]=!1),t.info_click[e])t.info_click[e]=!1;else{var n,a=t.info_click.length;for(n=0;n<a;++n)t.info_click[n]=!1;t.info_click[e]=!0}},t.sitemap=function(){var t="";t+="<?xml version='1.0' encoding='UTF-8'?>",t+="<urlset xmlns='http://www.sitemaps.org/schemas/sitemap/0.9'> ",p=autoCompleteData;for(var n in p)p.hasOwnProperty(n)&&(url="https://mf.zerodha.com/funds/"+p[n].code+"/"+s.generateSlug(p[n].name),date=new Date,t+="<url>",t+="<loc>"+url+"</loc>",t+="</url>");t+="</urlset>";var a=new Blob([t],{type:"text/xml"}),i=new File([a],"sitemap.xml"),o=e.MF_API_SERVER+"upload_sitemap";r.uploadFileToUrl(i,o).then(function(e){})}}]),app.controller("AuthCtrl",["$scope","$rootScope","$window","QAuthService","$location","$cookies","KiteAuthService",function(e,t,n,a,r,i,o){e.validate_msg="Please wait..","success"==r.search().status&&void 0!=r.search().request_token?(e.validate_msg="Please wait while we validate your login..",o.authenticate(r.search().request_token).then(function(a){0==a.data?e.validate_msg="Something went wrong. Please try again":401==a.data.status?e.validate_msg=!1:200==a.status?(i.put("validated",!0),i.put("session_token",a.data.session_token),i.put("client_id",a.data.client_id),i.put("client_name",a.data.name),t.fatcaFlag=a.data.fatca.fatca_flag,t.client_id=a.data.client_id,t.directSeenFlag=a.data.fatca.direct_notice_seen,window.location.replace(i.get("authRedirect"))):(e.validate_msg="Something went wrong. Please try again.",t.directSeenFlag=!0,n.location.replace(t.BASE_HOST+"logout"))})):"success"==r.search().status&&"true"==r.search().partner&&void 0!=r.search().session_token?e.validate_msg="Something went wrong. Please try again.":e.validate_msg="Something went wrong. Please try again.",e.login=function(){i.put("authRedirect",t.BASE_HOST+"dashboard"),n.location.replace(t.BASE_HOST+"login")}}]),app.controller("CategoryCtrl",["$scope","$rootScope","$routeParams","$location","mfService",function(e,t,n,a,r){function i(){var n=r.getTopMFInfo(e.categoryType,6);n.then(function(e){for(var n=0;n<e.length;n++){var a=e[n].master[0].schema_name+" ("+e[n].master[0].scheme_class+" : "+e[n].master[0].plan+")";e[n].master[0].scheme_id,e[n].master[0].scheme_class+" : "+e[n].master[0].plan,e[n].currentprice[0].ticker;t.categoryData.push({key:a,area:!1,values:e[n].graph})}})}e.categoryType=n.categoryType,t.categoryData=[],i()}]),app.controller("compareCtrl",["$route","$scope","$rootScope","$routeParams","$location","mfService","$window","$cookies","utilService","KiteAuthService",function(e,t,n,a,r,i,o,s,l,c){function d(e){var n="";switch(e){case 1:n=t.searchFor1;break;case 2:n=t.searchFor2;break;case 3:n=t.searchFor3}return n}function u(e){try{if(e.length>2){var a=i.getMFInfo(e,"eq");a.then(function(e){result=e.data,t.mfInfo1=result,t.amc_code1=result.bse_master[0].amc_code,t.graph1=result.graph,t.currentprice1=result.nav_prices[0],t.master1=result.master[0],t.searchFor1=result.master[0].name,t.chartKey1=result.master[0].name+" ("+result.master[0].scheme_class+" : "+result.master[0].plan+")",
t.fund1_selected_name=t.chartKey1,$.each(n.exampleData,function(e){if(1===n.exampleData[e].chart_no)return n.exampleData.splice(e,1),!1}),n.exampleData.push({key:t.searchFor1,chart_no:1,area:!1,color:"#4285F4",values:result.graph}),n.$broadcast("graphDataChange","Nothing here","nothing here too")}),t.mfId1=e,t.fund1_selected=!0}}catch(r){alert("Sorry unable to process."+r)}}function _(e){try{if(e){var a=i.getMFInfo(e,"eq");a.then(function(e){result=e.data,t.mfInfo2=result,t.amc_code2=result.bse_master[0].amc_code,t.graph2=result.graph,t.currentprice2=result.nav_prices[0],t.master2=result.master[0],t.searchFor2=result.master[0].name,t.chartKey2=result.master[0].name+" ("+result.master[0].scheme_class+" : "+result.master[0].plan+")",t.fund2_selected_name=t.chartKey2,$.each(n.exampleData,function(e){if(2===n.exampleData[e].chart_no)return n.exampleData.splice(e,1),!1}),n.exampleData.push({key:t.searchFor2,chart_no:2,area:!1,color:"#DB4437",values:result.graph}),n.$broadcast("graphDataChange","Nothing here","nothing here too")}),t.mfId2=e,t.fund2_selected=!0}}catch(r){alert("Sorry unable to process."+r)}}function p(e){try{if(e){var a=i.getMFInfo(e,"eq");a.then(function(e){result=e.data,t.mfInfo3=result,t.amc_code3=result.bse_master[0].amc_code,t.graph3=result.graph,t.currentprice3=result.nav_prices[0],t.master3=result.master[0],t.searchFor3=result.master[0].name,t.chartKey3=result.master[0].name+" ("+result.master[0].scheme_class+" : "+result.master[0].plan+")",t.fund3_selected_name=t.chartKey3,$.each(n.exampleData,function(e){if(3===n.exampleData[e].chart_no)return n.exampleData.splice(e,1),!1}),n.exampleData.push({key:t.searchFor3,chart_no:3,area:!1,color:"#F4B400",values:result.graph}),n.$broadcast("graphDataChange","Nothing here","nothing here too")}),t.mfId3=e,t.fund3_selected=!0}}catch(r){alert("Sorry unable to process."+r)}}function m(){t.mutualFundList1=[],t.mutualFundList2=[],t.mutualFundList3=[]}t.mfId1="",t.mfId2="",t.mfId3="",n.exampleData=[],t.mutualFundList=autoCompleteData,null!=a.id1&&void 0!=a.id1&&(t.mfId1=a.id1,u(t.mfId1)),null!=a.id2&&void 0!=a.id2&&(t.mfId2=a.id2,_(t.mfId2)),null!=a.id3&&void 0!=a.id3&&(t.mfId3=a.id3,p(t.mfId3)),t.login=function(){o.sessionStorage.authRedirect=r.absUrl(),s.put("authRedirect",r.absUrl()),o.location.replace(n.BASE_HOST+"login")},n.client_loggedIn&&(n.client_id=s.get("client_id"),n.client_name=s.get("client_name").split(" ")[0]),t.redirectToInvest=function(e,t){redirect="funds/"+e+"/"+l.generateSlug(t),o.location.replace(n.BASE_HOST+redirect)},t.removeSelection=function(e){1==e?(t.fund1_selected=!1,t.fund1_selected_name=""):2==e?(t.fund2_selected=!1,t.fund2_selected_name=""):3==e&&(t.fund3_selected=!1,t.fund3_selected_name="")},t.searchFilter=function(e){try{if(m(),t.searchFor=d(e),t.searchFor.length>2)switch(e){case 1:t.mutualFundList1=t.mutualFundList;break;case 2:t.mutualFundList2=t.mutualFundList;break;case 3:t.mutualFundList3=t.mutualFundList}}catch(n){alert("Sorry unable to process. "+n)}},t.mfSelected1=function(e){m(),void 0!=e&&u(e.originalObject.code)},t.mfSelected2=function(e){m(),void 0!=e&&_(e.originalObject.code)},t.mfSelected3=function(e){m(),void 0!=e&&p(e.originalObject.code)},t.onMFHintSelect=function(e,n){switch(m(),e){case 1:t.mfId1=n.code,t.searchFor1=n.name,u(n.code);break;case 2:t.mfId2=n.code,t.searchFor2=n.name,_(n.code);break;case 3:t.mfId3=n.code,t.searchFor3=n.name,p(n.code)}},t.customNavigate=function(){void 0==a.id1||null==a.id1?r.path("/"):(r.path("/funds/"+a.id1),o.location.reload())}}]),app.controller("DashboardCtrl",["$scope","$rootScope","$route","$routeParams","$location","mfService","SearchService","KiteAuthService","$window","DashboardDetails","SubscriptionServices","OrderService","$cookies",function(e,t,n,a,r,i,o,s,l,c,d,u,_){function p(e,t){nv.addGraph(function(){return chart=nv.models.sparklinePlus(),chart.margin({left:10,top:40,bottom:40,right:20}).x(function(e,t){return t}).showLastValue(!1).xTickFormat(function(t){return d3.time.format("%d-%b-%y")(new Date(e[t].x))}),d3.select("#scheme"+t).datum(e).call(chart),chart})}e.editModal=!1,e.deleteModal=!1,t.blur=!1,e.portfolio_table=!0,e.pendingOrders=!1,e.orderHistory=!1,e.portfolioOrderBy="amount",e.portfolioReverseSort=!0,e.tax_file_name=!1,e.tax_file_error=!1,e.select_year=!0,t.sparkline_data=[],e.info_click=[],e.itemsPerPage=10,e.currentPage=0,e.items=[],e.numberOfPages=function(){return Math.ceil(e.order_history.length/e.itemsPerPage)},e.setPage=function(t){e.currentPage=t},e.fy_years=[{name:"FY 2018-19",value:2018},{name:"FY 2017-18",value:2017},{name:"FY 2016-17",value:2016},{name:"FY 2015-16",value:2015}],e.select_year_toggle=function(){e.select_year=!0},e.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.pnlcalc=function(e){return e.net-e.amount},e.getTaxData=function(t){e.tax_file_name=!1,e.tax_file_error=!1,u.getTaxStatement(_.get("session_token"),t).then(function(t){e.select_year=!1,200==t.status?e.tax_file_name=t.data:(e.tax_file_error=t.message,alert(e.tax_file_error))})},e.showDeleteModal=function(n,a,r,i,o){e.deleteModal=!0,e.deleteStep=1,e.deleteBoxSchemeName=n,e.deletePurchaseType=r,e.deleteBseCode=i,e.order_id=a,t.blur=!0,2==o&&(e.deleteStep=2,e.deleteOrder(a,r,i))},e.deleteOrder=function(n,a,r){u.deleteOrder(n,a,r).then(function(n){200==n.status?c.getDetails(_.get("session_token")).then(function(a){200!=n.status?e.delete_status="Session expired. Redirecting to Q Login":(n=a.data,e.pending_orders=[],e.portfolio=[],e.order_history=[],e.pending_orders=n.pending_orders,e.portfolio=n.portfolio,e.order_history=n.order_history,e.client_details=a.client_details,t.client_balance=e.client_details.equity_balance,e.delete_status="Order deleted successfully")}):e.delete_status=n.message})},e.editOrder=function(t,n){u.editOrder(t,n).then(function(t){c.getDetails(_.get("session_token")).then(function(t){0==t?e.edit_status="Session expired.":(e.pending_orders=[],e.pending_orders=t[0],e.portfolio=[],e.portfolio=t[1][0],e.order_history=t[2][0],e.edit_status="Order Edited Successfully")})})},e.showEditModal=function(n,a,r,i,o){e.editModal=!0,e.editStep=1,e.editBoxSchemeName=n,e.editBoxAmount=r,e.order_id=a,e.order_type=i,t.blur=!0,2==o&&(e.editStep=2,e.editOrder(a,r))},e.showRedeemModal=function(n,a,r,i,o,s,l,c,d,u,_,p,m){e.redeemModal=!0,e.redeemSteps=1,e.redeemScheme=r,e.redeemWorth=o,e.redeemUnits=i,e.redeemBseCode=n,e.redeemDionCode=a,e.amc_code=s,e.redeemNav=l,e.redeemPrevNav=c,e.redeemChange=d,e.redeem_settlement_type=p,e.sale_units=i,e.min_redemp_qty=u,e.redemp_multiplier=_,t.blur=!0},e.processRedeem=function(n,a){1==a?(e.all_units_flag?all_units_flag="Y":all_units_flag="N",e.order_obj={session_token:_.get("session_token"),schema_id:e.redeemDionCode,order_type:"R",transaction_type:"",transaction_amount:n,bse_scheme_code:e.redeemBseCode,purchase_type:"Regular",dividend_status:"",frequency:"Once",intervals:"1",nav_limit:0,all_units_flag:all_units_flag,sip_initial_amount:0,sip_month_data:0},e.redeemSteps=2):2==a&&(t.loading=!0,u.sendOrder(e.order_obj).then(function(n){c.getDetails(_.get("session_token")).then(function(a){200!=a.status?(e.order_status=!1,t.loading=!1):(n=a.data,e.pending_orders=[],e.portfolio=[],e.order_history=[],e.pending_orders=n.pending_orders,e.portfolio=n.portfolio,e.order_history=n.order_history,e.client_details=a.client_details,t.client_balance=e.client_details.equity_balance,e.order_status=!0,t.loading=!1)})}),e.redeemSteps=3)},e.closeModal=function(){e.editModal=!1,e.deleteModal=!1,e.redeemModal=!1,e.redeemSteps=1,t.blur=!1},e.portfolio_tab=function(t){switch(t){case 1:e.portfolio_table=!0,e.orderHistory=!1;break;case 2:e.portfolio_table=!1,e.orderHistory=!0}},t.$watch("blur",function(){0==t.blur&&e.closeModal()}),e.login=function(){l.sessionStorage.authRedirect=r.absUrl(),_.put("authRedirect",r.absUrl()),l.location.replace(t.BASE_HOST+"login")},e.showSubTable=function(n,a){if(void 0==e.info_click[n]&&(e.info_click[n]=!1),e.info_click[n])e.info_click[n]=!1;else{var r,i=e.info_click.length;for(r=0;r<i;++r)e.info_click[r]=!1;e.info_click[n]=!0}p(t.sparkline_data[a],n)},t.client_loggedIn?(t.loading=!0,c.getDetails(_.get("session_token")).then(function(n){data=n.data,0==data&&(s.logout(_.get("session_token")),e.login()),e.pending_orders=data.pending_orders,e.portfolio=data.portfolio;for(var a=0;a<e.portfolio.length;a++){var r=e.portfolio[a].schema_id;newval=[];for(var i=0;i<e.portfolio[a].sparkline_data.length;i++)i%5==0&&newval.push(e.portfolio[a].sparkline_data[i]),i==e.portfolio[a].sparkline_data.length-1&&newval.push(e.portfolio[a].sparkline_data[i]);t.sparkline_data[r]=newval}e.order_history=data.order_history,e.sip_details=data.sip_details,e.client_details=n.client_details,t.client_balance=e.client_details.equity_balance,t.client_name=n.client_details.name.split(" ")[0],t.client_id=n.client_details.client_id,t.directSeenFlag=e.client_details.direct_notice_seen,t.directSeenFlag||(t.blur=!0),e.order_history.sort(function(e,t){return moment(t.ordered_at).toDate()-moment(e.ordered_at).toDate()}),t.loading=!1})):e.login()}]),app.controller("DescriptionCtrl",["$scope","$rootScope","$routeParams","mfService","SearchService","$window","$location","OrderService","$timeout","$filter","$cookies","KiteAuthService","PartnerService","ngMeta","utilService",function(e,t,n,a,r,i,o,s,l,c,d,u,_,p,m){function h(){f()}function g(e){var t,n;return e=Math.round(100*e)/100+""||"",t=e.split("."),n=t[1]||null,t=t[0].replace(/(\d)(?=(\d\d)+\d$)/g,"$1,"),e=n?t+"."+n:t}function f(){try{var n=a.getMFInfo(e.mfId,"normal");n.then(function(n){result=n.data,e.invested_scheme=!1,e.purchase_flag=!0,e.redemp_allowed=!0,e.invested_units=0,e.investment_worthy=0,e.master=result.master,e.currentprice=result.nav_prices[0],e.mfInfo=result,e.graph=result.graph,e.bse_master=result.bse_master,e.purchase_status=!1,e.payout_purchase_status=!1,e.reinvest_purchase_status=!1;var a=result.direct_regular_map;if(t.partner_loggedIn?e.purchase_status=!1:e.purchase_status=result.purchase_status.normal,t.client_loggedIn&&result.client_details)t.client_id=result.client_details.client_id,e.acc_balance=result.client_details.equity_balance,t.client_name=result.client_details.name.split(" ")[0],t.directSeenFlag=result.client_details.direct_notice_seen,t.directSeenFlag||(t.blur=!0);else{t.client_loggedIn=!1,t.directSeenFlag=!0;var r=d.getAll();angular.forEach(r,function(e,t){"utm_source"!=t&&d.remove(t)}),i.sessionStorage.clear(),localStorage.clear()}t.partner_loggedIn&&(t.partner_id=result.partner_details.partner_id),e.sip_conditional_nav=parseFloat(e.currentprice.nav,2);var o=1e5*e.master[0].total_aum;e.total_aum=o/Math.pow(10,7),e.total_aum=g(e.total_aum);for(var s=[],l=0;l<e.bse_master.length;l++)flag=e.bse_master[l].div_reinvestment_flag,s.indexOf(flag)==-1&&s.push(flag);1==s.length&&("N"==s[0]?(e.div_reinvest=!1,e.div_reinvest_flag="N",e.sip_div_reinvest_flag="N",e.payout_purchase_status=result.purchase_status.div_payout,e.purchase_status=result.purchase_status.div_payout):"Y"==s[0]?(e.div_reinvest=!1,e.div_reinvest_flag="Y",e.sip_div_reinvest_flag="Y",e.reinvest_purchase_status=result.purchase_status.div_reinvest,e.purchase_status=result.purchase_status.div_reinvest):"Z"==s[0]&&(e.div_reinvest=!1,e.div_reinvest_flag="Z",e.sip_div_reinvest_flag="Z",e.normal_purchase_status=result.purchase_status.normal,e.purchase_status=result.purchase_status.normal)),s.indexOf("Y")!=-1&&s.indexOf("N")!=-1&&(e.div_reinvest=!0,e.div_reinvest_flag=e.DivOptions[0].value,e.sip_div_reinvest_flag=e.DivOptions[0].value,e.payout_purchase_status=result.purchase_status.div_payout,e.reinvest_purchase_status=result.purchase_status.div_reinvest),e.min_inv_amt=0,e.min_redemp_qty=0,e.min_additional_multiplier=0,e.min_inv_amt=e.bse_master[0].min_purchase_amt,e.min_redemp_qty=e.bse_master[0].min_redemp_qty,e.min_additional_purchase=e.bse_master[0].additional_purchase_amt,e.purchase_amt_multipler=e.bse_master[0].purchase_amt_multipler,e.scheme_plan="DIRECT";for(var c=0,l=0;l<e.bse_master.length;l++)"DIRECT"!=e.bse_master[l].scheme_plan&&c++;c==e.bse_master.length&&(e.scheme_plan="NORMAL");for(var l=0;l<e.bse_master.length;l++){""!=e.bse_master[l].amc_code?(e.amc_code=e.bse_master[l].amc_code,parseFloat(e.min_inv_amt)>parseFloat(e.bse_master[l].min_purchase_amt)&&(e.min_inv_amt=e.bse_master[l].min_purchase_amt,e.purchase_amt_multipler=e.bse_master[l].purchase_amt_multipler),parseFloat(e.min_redemp_qty)<parseFloat(e.bse_master[l].min_redemp_qty)&&(e.min_redemp_qty=e.bse_master[l].min_redemp_qty),parseFloat(e.min_additional_purchase)>parseFloat(e.bse_master[l].additional_purchase_amt)&&(e.min_additional_purchase=e.bse_master[l].additional_purchase_amt)):e.amc_code=!1;var u=null;for(u=0;amc_sid_list.length>u;u+=1)amc_sid_list[u].amc_code==e.amc_code&&(e.sid_link=amc_sid_list[u].sid_link)}a&&("NORMAL"==e.scheme_plan?(a=a.direct_data,e.direct_expense_ratio=a.expense_ratio,e.direct_scheme_code=a.scheme_code,e.returns_duration=a.returns_duration,e.direct_returns_percent=a.returns_percent,e.regular_expense_ratio=e.master[0].expenses_ratio,"3 years"==a.returns_duration?e.regular_returns_percent=e.currentprice.three_year_comp_per:"1 year"==a.returns_duration?e.regular_returns_percent=e.currentprice.year_per:"6 months"==a.returns_duration?e.regular_returns_percent=e.currentprice.six_month_per:"3 months"==a.returns_duration?e.regular_returns_percent=e.currentprice.three_month_per:"1 month"==a.returns_duration?e.regular_returns_percent=e.currentprice.one_month_pre:"1 week"==a.returns_duration&&(e.regular_returns_percent=e.currentprice.one_week_per),e.direct_url="funds/"+e.direct_scheme_code+"/"+m.generateSlug(a.name)):(a=a.regular_data,e.regular_expense_ratio=a.expense_ratio,e.regular_scheme_code=a.scheme_code,e.returns_duration=a.returns_duration,e.regular_returns_percent=a.returns_percent,e.direct_expense_ratio=e.master[0].expenses_ratio,"3 years"==a.returns_duration?e.direct_returns_percent=e.currentprice.three_year_comp_per:"1 year"==a.returns_duration?e.regular_returns_percent=e.currentprice.year_per:"6 months"==a.returns_duration?e.regular_returns_percent=e.currentprice.six_month_per:"3 months"==a.returns_duration?e.regular_returns_percent=e.currentprice.three_month_per:"1 month"==a.returns_duration?e.regular_returns_percent=e.currentprice.one_month_pre:"1 week"==a.returns_duration&&(e.regular_returns_percent=e.currentprice.one_week_per)),"Debt"==result.master[0].custom_main_category&&(e.calculator.returns=8),e.directRegularCalc(e.calculator.type,e.calculator.amount,e.calculator.duration,e.direct_expense_ratio,e.regular_expense_ratio,e.calculator.returns),e.showCalc=!0),e.sale_units=parseFloat(e.min_redemp_qty),e.mf_id=e.mfId,e.searchFor=result.master[0].short_name+" ("+result.master[0].scheme_class+" : "+result.master[0].plan+")",e.chartKey=result.master[0].name+" ("+result.master[0].scheme_class+" : "+result.master[0].plan+")",e.mf_name=result.master[0].name,e.min_inv_amt=parseFloat(e.min_inv_amt),"additional"==e.purchase_status?e.invest_amount=parseFloat(e.min_additional_purchase):e.invest_amount=e.min_inv_amt,e.sip_initial_inv=e.min_inv_amt,e.sip_installment_amount=parseFloat(e.min_additional_purchase);var _=result.master[0].name+" - "+i.document.title;i.document.title=_,p.setTag("description"," - Invest in lumpsum or start an SIP with just two clicks in "+result.master[0].name+" - "+result.master[0].custom_main_category),p.setTag("keywords",", "+result.master[0].name+", "+result.master[0].custom_main_category);for(var h=[],u=0;u<result.graph.length;u++)u%2==0&&h.push(result.graph[u]);t.exampleData.push({key:"NAV Price",area:!1,color:"#187cd0",values:h}),e.getSIPGraph(e.graph),void 0!=result.eq_graph&&t.exampleData.push({key:"Equity Curve - Rs. 100/- Invested",area:!1,color:"#DB4437",disabled:!0,values:result.eq_graph})})}catch(r){alert("Sorry unable to process.")}}e.fundName=a.getSearchName(),e.mfId=n.id,e.mfInfo=[],e.graph={},e.currentprice=[],e.master=[],e.others=[],t.exampleData=[],t.sipData=[],e.order_progress=!0,e.order_status=void 0,e.investModal=!1,e.redeemModal=!1,e.sipModal=!1,e.investSteps=1,e.redeemSteps=1,e.sipSteps=1,e.fixed_investment=!1,e.rule_based_investment=!1,t.blur=!1,e.div_reinvest=!1,e.sip_flag=!1,e.amc_code=!1,e.sip_intervals="",e.acc_balance=!1,e.showCalc=!1,e.cagr_select="1",e.calculator={type:"s",amount:5e4,duration:"25",returns:15},e.conditional_flag={value:!1},e.start_sip_today={value:!1},e.indefinite_interval={value:!0},e.DivOptions=[{name:"Re-Invest",value:"Y"},{name:"Payout",value:"N"}],e.SipFrequency=[{name:"Weekly",value:"Weekly"},{name:"15 days",value:"15-days"},{name:"Monthly",value:"Monthly"},{name:"Quarterly",value:"Quarterly"}],e.SipMonthDates=[{name:"Every 30 days",value:0},{name:"Every 1st",value:1},{name:"Every 5th",value:5},{name:"Every 10th",value:10},{name:"Every 15th",value:15},{name:"Every 20th",value:20},{name:"Every 25th",value:25}],e.sip_month_data=e.SipMonthDates[0].value,e.sip_frequency_list=e.SipFrequency[0].value;for(var v=[],S=0;S<31;S++)v.push(S);e.range=v,e.directRegularCalc=function(t,n,a,r,i,o,s){s=s||!1,e.direct_returns=0,e.regular_returns=0;var l=252*a,c=(o-r)/252,d=(o-i)/252;if("l"==t){e.direct_returns=n,e.regular_returns=n;for(var u=0;u<=l;u++)e.direct_returns=e.direct_returns*(1+c/100),e.regular_returns=e.regular_returns*(1+d/100)}else if("s"==t){e.direct_returns=n,e.regular_returns=n,counter=1;for(var u=1;u<=l;u++)e.direct_returns=e.direct_returns*(1+c/100),e.regular_returns=e.regular_returns*(1+d/100),counter%20==0&&u!=l&&(e.direct_returns=e.direct_returns+n,e.regular_returns=e.regular_returns+n,counter=0),counter++}},e.$watch("calculator.type",function(t){"l"==t?e.calculator.amount=1e5:"s"==t&&(e.calculator.amount=5e3),e.directRegularCalc(t,e.calculator.amount,e.calculator.duration,e.direct_expense_ratio,e.regular_expense_ratio,e.calculator.returns)},!0),e.showInvestModal=function(n,a){n?(e.investModal=!0,e.redeemModal=!1,e.sipModal=!1,t.blur=!0,e.client_loggedIn?1==a&&"blocked"!=e.purchase_status&&(e.acc_balance||(t.loading=!0,u.get_balance(d.get("session_token")).then(function(n){e.acc_balance=n.data,t.loading=!1}))):e.partner_loggedIn&&1==a&&console.log("hello partner")):e.login()},e.showRedeemModal=function(){e.redeemModal=!0,e.investModal=!1,e.sipModal=!1,t.blur=!0},e.showSipModal=function(n){n?(e.sipModal=!0,e.investModal=!1,t.blur=!0):e.login()},e.closeModal=function(){e.investModal=!1,e.redeemModal=!1,e.sipModal=!1,e.investSteps=1,e.redeemSteps=1,e.sipSteps=1,t.blur=!1},t.$watch("blur",function(){0==t.blur&&e.closeModal()}),e.investment_div=function(t){"Fixed"==t&&(e.fixed_investment=!0,e.rule_based_investment=!1),"Rules"==t&&(e.fixed_investment=!1,e.rule_based_investment=!0)},e.getSIPGraph=function(n,a,r,i){n=n||e.graph,a=a||5e3,r=r||n[0].x,i=i||n[n.length-1].x,e.sip_price=a,e.sip_start_date=c("date")(r,"MM/dd/yyyy"),e.sip_end_date=c("date")(i,"MM/dd/yyyy"),r=new Date(r),sip_start_date_formatted=c("date")(r,"dd-MM-yyyy"),i=new Date(i);var o=c("date")(r,"dd"),s=0,l=s,d=0,u=0,_=0,p="SIP at Rs. "+a+"/- per month",m=0,h=[],g=[],f=[],v=[];for(var S in n){var y=new Date(n[S].x);if(y>=r&&y<=i){var b=c("date")(y,"MM"),w=c("date")(y,"dd"),E=c("date")(y,"dd-MM-yyyy");if(0==m){var F=b;w>=o&&(s=a,l=s,d=a/parseFloat(n[S].y),u=d,m++,_++,h.push(0-a),g.push(E),f.push({x:n[S].x,y:a*_}),v.push({x:n[S].x,y:l}))}else 1==m&&(b!=F?w>=o&&(F=b,d=a/parseFloat(n[S].y),u+=d,l=u*parseFloat(n[S].y),_++,h.push(0-a),g.push(E),f.push({x:n[S].x,y:a*_}),v.push({x:n[S].x,y:l})):(l=u*parseFloat(n[S].y),v.push({x:n[S].x,y:l})))}}$.each(t.sipData,function(e){t.sipData.splice(e,1),t.sipData.splice(e,2)}),g.push(E),h.push(l),e.irr_value=100*XIRR(h,g),e.installments=_,e.total_invested=_*a,e.investment_value=l,e.sip_start=sip_start_date_formatted,e.sip_end=E,e.net_profit=e.investment_value-e.total_invested,e.net_profit_percent=e.net_profit/e.total_invested*100,t.sipData.push({key:p,area:!1,color:"#187cd0",values:v}),t.sipData.push({key:"Total Invested",color:"#96710a",disabled:!1,values:f,strokeWidth:1,classed:"dashed"}),t.$broadcast("graphDataChange","Nothing here","nothing here too")},e.login=function(){i.sessionStorage.authRedirect=o.absUrl(),d.put("authRedirect",o.absUrl()),i.location.replace(t.BASE_HOST+"login")},e.processSIP=function(n,a,r,i,o,l,c,u){1==r?(i="undefined"!=typeof i?i:"Z",c="undefined"!=typeof c?c:0,u="undefined"!=typeof u&&u,e.sip_purchase_status="fresh",e.start_sip_today=!1,e.div_reinvest?"Y"==i?e.sip_purchase_status=e.reinvest_purchase_status:"N"==i&&(e.sip_purchase_status=e.payout_purchase_status):"Z"==i?e.sip_purchase_status=e.normal_purchase_status:"N"==i&&(e.sip_purchase_status=e.payout_purchase_status),1==e.indefinite_interval.value&&(l=5e4),null==l&&(l=5e4),"fresh"==e.sip_purchase_status?(e.order_obj={session_token:d.get("session_token"),schema_id:e.mfId,order_type:"P",transaction_type:"FRESH",transaction_amount:n,bse_scheme_code:"",purchase_type:"Regular",dividend_status:i,frequency:"Once",intervals:0,nav_limit:0,all_units_flag:"",sip_initial_amount:0,sip_month_data:0,tag:d.get("utm_source")},e.sip_order={session_token:d.get("session_token"),schema_id:e.mfId,order_type:"P",transaction_type:"FRESH",transaction_amount:a,bse_scheme_code:"",purchase_type:"SIP",dividend_status:i,frequency:o,intervals:l,nav_limit:0,all_units_flag:"",sip_initial_amount:n,sip_month_data:c,tag:d.get("utm_source")}):(u===!0&&(e.order_obj={session_token:d.get("session_token"),schema_id:e.mfId,order_type:"P",transaction_type:"ADDITIONAL",transaction_amount:a,bse_scheme_code:"",purchase_type:"Regular",dividend_status:i,frequency:"Once",intervals:0,nav_limit:0,all_units_flag:"",sip_initial_amount:0,sip_month_data:0,tag:d.get("utm_source")},e.start_sip_today=!0),e.sip_order={session_token:d.get("session_token"),schema_id:e.mfId,order_type:"P",transaction_type:"FRESH",transaction_amount:a,bse_scheme_code:"",purchase_type:"SIP",dividend_status:i,frequency:o,intervals:l,nav_limit:0,all_units_flag:"",sip_initial_amount:0,sip_month_data:c,tag:d.get("utm_source")}),e.sipSteps=2):2==r&&(t.loading=!0,"fresh"==e.sip_purchase_status?(s.sendOrder(e.order_obj).then(function(n){200==n.status?s.sendOrder(e.sip_order).then(function(n){e.order_status_msg=n.message,200==n.status?e.sip_order_status=!0:e.sip_order_status=!1,t.loading=!1}):(e.order_status_msg=n.message,e.sip_order_status=!1)}),e.sipSteps=3):(t.loading=!0,e.start_sip_today&&s.sendOrder(e.order_obj).then(function(e){200!=e.status&&alert("Could not start SIP today.")}),s.sendOrder(e.sip_order).then(function(n){e.order_status_msg=n.message,200==n.status?e.sip_order_status=!0:e.sip_order_status=!1,t.loading=!1}),e.sipSteps=3))},e.partner_client_scheme_mapcheck=function(t,n){return e.partner_client_blocked=!1,6==t.length&&(t=t.toUpperCase(),_.partner_client_mapcheck(t,d.get("session_token")).then(function(a){1==a.data?_.partner_client_scheme_statuscheck(t,n,d.get("session_token")).then(function(t){"blocked"!=t.data?(e.purchase_status=t.data,e.partner_client_blocked=!1):(e.partner_client_blocked=!0,e.partner_blocked_msg="Fund is blocked for this client. Maybe he has a pending order on same fund.")}):(e.partner_client_blocked=!0,e.partner_blocked_msg="Client ID not mapped to your partner ID or client's MF account is not activated yet.")})),!0},e.processOrder=function(n,a,r,i,o){if(r="undefined"!=typeof r?r:"Z",i="undefined"!=typeof i&&i,o="undefined"!=typeof o?o:null,e.invest_amount=n,1==a)if(e.partner_loggedIn&&null!=o)e.partner_clientid_valid=!1,6==o.length?(o=o.toUpperCase(),_.partner_client_mapcheck(o,d.get("session_token")).then(function(a){if(1==a.data){e.bse_scheme_code=!1,e.amount=n,t.partner_clientid=o,e.partner_clientid_valid=!0,e.div_reinvest?"Y"==r?e.purchase_status=e.reinvest_purchase_status:"N"==r&&(e.purchase_status=e.payout_purchase_status):"Z"==r&&(e.purchase_status=e.normal_purchase_status);var s="ADDITIONAL";"fresh"==e.purchase_status&&(s="FRESH"),e.conditional_flag.value?e.order_obj={partner_session_token:d.get("session_token"),client_id:o,schema_id:e.mfId,order_type:"P",transaction_type:s,transaction_amount:e.amount,bse_scheme_code:"",purchase_type:"Conditional",dividend_status:r,frequency:"Once",intervals:0,nav_limit:i,all_units_flag:"",sip_initial_amount:0,sip_month_data:0,tag:d.get("utm_source")}:e.order_obj={partner_session_token:d.get("session_token"),client_id:o,schema_id:e.mfId,order_type:"P",transaction_type:s,transaction_amount:e.amount,bse_scheme_code:"",purchase_type:"Regular",dividend_status:r,frequency:"Once",intervals:0,nav_limit:0,all_units_flag:"",sip_initial_amount:0,sip_month_data:0,tag:d.get("utm_source")}}else e.partner_clientid_valid=!1}),e.investSteps=2):alert("Invalid client ID");else{e.bse_scheme_code=!1,e.amount=n,e.div_reinvest?"Y"==r?e.purchase_status=e.reinvest_purchase_status:"N"==r&&(e.purchase_status=e.payout_purchase_status):"Z"==r&&(e.purchase_status=e.normal_purchase_status);var l="ADDITIONAL";"fresh"==e.purchase_status&&(l="FRESH"),e.conditional_flag.value?e.order_obj={session_token:d.get("session_token"),schema_id:e.mfId,order_type:"P",transaction_type:l,transaction_amount:e.amount,bse_scheme_code:"",purchase_type:"Conditional",dividend_status:r,frequency:"Once",intervals:0,nav_limit:i,all_units_flag:"",sip_initial_amount:0,sip_month_data:0,tag:d.get("utm_source")}:e.order_obj={session_token:d.get("session_token"),schema_id:e.mfId,order_type:"P",transaction_type:l,transaction_amount:e.amount,bse_scheme_code:"",purchase_type:"Regular",dividend_status:r,frequency:"Once",intervals:0,nav_limit:0,all_units_flag:"",sip_initial_amount:0,sip_month_data:0,tag:d.get("utm_source")},e.investSteps=2}else 2==a&&(t.loading=!0,e.partner_loggedIn?_.sendOrder(e.order_obj).then(function(n){e.order_status_msg=n.message,200==n.status?e.order_status=!0:e.order_status=!1,t.loading=!1}):e.client_loggedIn&&s.sendOrder(e.order_obj).then(function(n){e.order_status_msg=n.message,200==n.status?e.order_status=!0:e.order_status=!1,t.loading=!1}),e.investSteps=3)},h(),e.selectedDividend=function(t){e.frequencyList=t;for(var n in t)if(""!=n){e.selectedFrequencyValue=t[n];break}e.sip_dividend_option=e.selectedFrequencyValue.div_reinvestment_flag,e.sip_scheme_code=e.selectedFrequencyValue.scheme_code,e.sip_amc_code=e.selectedFrequencyValue.amc_code,e.selectedFrequency(e.selectedFrequencyValue)},e.selectedFrequency=function(t){null!=t&&(e.daysList=t.days,e.sip_min_investment=t.min_inv_amt,e.sip_min_installments=t.min_num_installments,e.sip_multiplier_amt=t.multiplier_amt,e.sip_frequency=t.sip_frequency)},e.customNavigate=function(e){o.path("/compare/"+e)}}]),app.controller("FaqCtrl",["$scope","$rootScope","$location","$window","$route","$cookies","KiteAuthService","SubscriptionServices",function(e,t,n,a,r,i,o,s){t.blur=!1,e.login=function(){i.put("authRedirect",n.absUrl()),a.location.replace(t.BASE_HOST+"login")},t.client_loggedIn&&(t.client_id=i.get("client_id"),t.client_name=i.get("client_name").split(" ")[0])}]),app.controller("FatcaCtrl",["$scope","$rootScope","$location","$cookies","$window","KiteAuthService","OrderService",function(e,t,n,a,r,i,o){e.system_message="Please wait..",e.login=function(){r.sessionStorage.authRedirect=t.BASE_HOST,a.put("authRedirect",t.BASE_HOST),r.location.replace(t.BASE_HOST+"login")},t.client_loggedIn?(i.client_details(a.get("session_token")).then(function(n){0!=n.data.client_details?(e.investor_name=n.data.client_details.name,e.email_id=n.data.client_details.email,e.mobile_num=n.data.client_details.mobile,e.pan_id=n.data.client_details.pan,null!=n.data.client_details.fatca_flag?e.system_message="FATCA registration already completed.":e.system_message=!1,t.client_id=n.data.client_details.client_id,t.client_name=a.get("client_name").split(" ")[0],t.directSeenFlag=n.data.client_details.direct_notice_seen,t.directSeenFlag||(t.blur=!0)):(e.system_message="User details could not be fetched. You will be logged out. Please contact Zerodha support",e.login())}),e.fatca_submit=function(t,n,r,i,s,l,c,d,u,_,p){e.facta_object={pan_number:t,investor_name:n,tax_status:"01",data_source:"E",address_type:l,birth_place:s,birth_country:"IN",tax_residence:"IN",tax_pin:t,id_type:"C",income_source:p,gross_income:d,pep_flag:c,occupation:u,occupation_type:_,exchange_name:"B",ubo_application:"N",sdf_flag:"N",ubo_df:"N",new_change:"N",mobile_num:i,email_id:r,session_token:a.get("session_token")},o.fatcaRegistration(e.facta_object).then(function(t){200==t.status?e.system_message="FATCA registration successful":e.system_message="Something went wrong."})}):e.login()}]),app.filter("fund_url",["utilService",function(e){return function(t){return slug=e.generateSlug(t),slug}}]),app.controller("FundsCtrl",["$scope","$rootScope","utilService","$location","KiteAuthService","$cookies",function(e,t,n,a,r,i){e.fundList=autoCompleteData,e.selectFund=function(e,t){redirect="/funds/"+e+"/"+n.generateSlug(t),a.url(redirect)},t.client_loggedIn===!0&&r.client_details(i.get("session_token")).then(function(e){t.client_id=e.data.client_details.client_id})}]),app.controller("FundsRegularCtrl",["$scope","$rootScope","utilService","$location","KiteAuthService","$cookies",function(e,t,n,a,r,i){e.regularFundList=autoCompleteDataRegular,e.selectFund=function(e,t){redirect="/funds/"+e+"/"+n.generateSlug(t),a.url(redirect)},t.client_loggedIn===!0&&r.client_details(i.get("session_token")).then(function(e){t.client_id=e.data.client_details.client_id,t.client_name=e.data.client_details.name.split(" ")[0]})}]),app.controller("GraphCtrl",["$scope","$rootScope","$location","utilService","SearchService",function(e,t,n,a,r){function i(){var e=r.getLandPageData();e.then(function(e){for(var n=e.data,a=["#9D51B3","#BF6E6C","#9466C9","#87A170"],r=0,i=1;r<n.length;r++,i++){for(var o=n[r][i].master[0].name+" ("+n[r][i].master[0].scheme_class+" : "+n[r][i].master[0].plan+")",s=n[r][i].master[0].scheme_id,l=n[r][i].master[0].scheme_class+" : "+n[r][i].master[0].plan,c=n[r][i].master[0].schema_name,d=[],u=0;u<n[r][i].graph.length;u++)u%30==0&&d.push(n[r][i].graph[u]);t.exampleData.push({key:o,area:!0,color:a[r%a.length],scheme_id:s,scheme_plan:l,name:c,values:d})}})}t.exampleData=[],i()}]),app.controller("HomeCtrl",["$rootScope","$scope","mfService","SearchService","utilService","$location","$window","$cookies","$timeout","HTTPFactory","AddLead",function(e,t,n,a,r,i,o,s,l,c,d){function u(){var a=n.getMFInfo(e.WEALTH_FUND_CODE,"normal");a.then(function(n){if(result=n.data,console.log(e.client_loggedIn,e.client_id,result.client_details),e.client_loggedIn&&result.client_details)e.client_id=s.get("client_id"),e.client_name=s.get("client_name").split(" ")[0],e.client_name||(e.client_name=result.client_details.name.split(" ")[0]),e.directSeenFlag=result.client_details.direct_notice_seen,e.directSeenFlag||(e.blur=!0);else{e.client_loggedIn=!1,e.directSeenFlag=!0;var a=s.getAll();angular.forEach(a,function(e,t){"utm_source"!=t&&s.remove(t)}),o.sessionStorage.clear(),localStorage.clear()}e.partner_loggedIn&&(e.partner_id=result.partner_details.partner_id),t.wealthFundName=result.master[0].name,t.wealthFundPlan=result.master[0].plan,t.wealthFundSchemeCode=result.master[0].scheme_id,t.wealthCurrentprice=result.nav_prices[0],t.wealthAmcCode=result.bse_master[0].amc_code,t.wealthURL="funds/"+t.wealthFundSchemeCode+"/"+r.generateSlug(t.wealthFundName)}),a=n.getMFInfo(e.TAX_FUND_CODE,"normal"),a.then(function(e){result=e.data,t.taxFundName=result.master[0].name,t.taxFundPlan=result.master[0].plan,t.taxFundSchemeCode=result.master[0].scheme_id,t.taxCurrentprice=result.nav_prices[0],t.taxAmcCode=result.bse_master[0].amc_code,t.taxURL="funds/"+t.taxFundSchemeCode+"/"+r.generateSlug(t.taxFundName)}),a=n.getMFInfo(e.SHORT_FUND_CODE,"normal"),a.then(function(e){result=e.data,t.shortFundName=result.master[0].name,t.shortFundPlan=result.master[0].plan,t.shortFundSchemeCode=result.master[0].scheme_id,t.shortCurrentprice=result.nav_prices[0],t.shortAmcCode=result.bse_master[0].amc_code,t.shortFundURL="funds/"+t.shortFundSchemeCode+"/"+r.generateSlug(t.shortFundName);
})}e.landngPageData=[],e.wealthGraph=[],e.taxGraph=[],e.mffd_graph=[],t.mffd_invested=1e5,t.showCalcFlag=!1,t.percent_slider={value:15,options:{floor:0,ceil:50,onChange:function(){t.calc(t.mffd_invested,t.year_slider.value,t.percent_slider.value)}}},t.year_slider={value:25,options:{ceil:25,floor:1,onChange:function(){t.calc(t.mffd_invested,t.year_slider.value,t.percent_slider.value)}}},u(),t.login=function(){o.sessionStorage.authRedirect=i.absUrl(),s.put("authRedirect",i.absUrl()),o.location.replace(e.BASE_HOST+"login")},t.newaccount=function(){if(void 0!=t.new_name&&void 0!=t.new_phone&&void 0!=t.new_email){var e="RAINMT";document.getElementById("zlm_partner_id")&&(e=document.getElementById("zlm_partner_id").value),d.addLead(t.new_name,t.new_email,t.new_phone,e).then(function(e){if(e&&200==e.status){var n=e.data,a="https://zerodha.com/account/auth/password/reset/"+t.new_email+"/"+n;window.location.replace(a)}else e?t.newaccount_return=e.message:t.newaccount_return="Error registering your data. Please contact support@zerodha.com",t.newaccount_submit=!0})}}}]),app.controller("LoginCtrl",["$scope","$rootScope","$http","$location","$routeParams","$window","KiteAuthService","$route","$cookies","PartnerService",function(e,t,n,a,r,i,o,s,l,c){l.get("validated")?void 0!=a.search().redirect?(l.put("authRedirect",t.BASE_HOST+a.search().redirect.substr(1)),window.location.replace(t.BASE_HOST+a.search().redirect.substr(1))):window.location.replace(t.BASE_HOST+"dashboard"):(void 0!=a.search().redirect?l.put("authRedirect",t.BASE_HOST+a.search().redirect.substr(1)):void 0==l.get("authRedirect")&&l.put("authRedirect",t.BASE_HOST+"dashboard"),window.location.replace("https://kite.trade/connect/login?api_key="+t.KITE_CONNECT_APIKEY))}]),app.controller("LogoutCtrl",["$scope","$window","$rootScope","KiteAuthService","$cookies","$location","PartnerService",function(e,t,n,a,r,i,o){if(r.get("session_token")){var s=r.get("session_token");n.loading=!0,n.directSeenFlag=!0,0===s.lastIndexOf("ptnr_",0)?(n.partner_loggedIn=!1,o.logout(r.get("session_token")).then(function(e){n.loading=!1})):(n.client_loggedIn=!1,a.logout(r.get("session_token")).then(function(e){n.loading=!1}))}var l=r.getAll();angular.forEach(l,function(e,t){"utm_source"!=t&&r.remove(t)}),t.sessionStorage.clear(),localStorage.clear(),e.login=function(){t.location.replace(n.BASE_HOST+"login")}}]),app.controller("OrderHistoryCtrl",["$scope","$rootScope","$route","$routeParams","$location","mfService","SearchService","KiteAuthService","$window","DashboardDetails","SubscriptionServices","OrderService","$cookies",function(e,t,n,a,r,i,o,s,l,c,d,u,_){t.blur=!1,e.portfolio_table=!1,e.pendingOrders=!1,e.orderHistory=!0,e.itemsPerPage=10,e.currentPage=0,e.numberOfPages=function(){return Math.ceil(e.order_history.length/e.itemsPerPage)},e.setPage=function(t){e.currentPage=t},e.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.login=function(){l.sessionStorage.authRedirect=r.absUrl(),_.put("authRedirect",r.absUrl()),l.location.replace(t.BASE_HOST+"login")},e.closeModal=function(){e.reorderModal=!1,e.reorderStep=1,t.blur=!1},t.$watch("blur",function(){0==t.blur&&e.closeModal()}),e.showReorderModal=function(n,a){e.reorderModal=!0,e.reorderStep=1,e.reorderOrderId=n,e.reorder_progress=1,t.blur=!0,2==a&&(e.reorderStep=2,e.reorder_progress=2,e.reorder_data={session_token:_.get("session_token"),order_id:e.reorderOrderId},t.loading=!1,c.reOrder(e.reorder_data).then(function(n){401==n.status?(s.logout(_.get("session_token")),e.login()):200==n.status?c.orderHistory(_.get("session_token")).then(function(a){n=a.data,e.order_history=a.data,e.client_details=a.client_details,t.client_balance=e.client_details.equity_balance,t.client_name=a.client_details.name.split(" ")[0],t.client_id=a.client_details.client_id,t.directSeenFlag=e.client_details.direct_notice_seen,t.directSeenFlag||(t.blur=!0),e.order_history.sort(function(e,t){return moment(t.ordered_at).toDate()-moment(e.ordered_at).toDate()}),t.loading=!1,e.reorder_progress=3}):e.sip_delete_status="Failed to delete"}))},t.client_loggedIn?(t.loading=!0,c.orderHistory(_.get("session_token")).then(function(n){data=n.data,e.order_history=n.data,e.client_details=n.client_details,t.client_balance=e.client_details.equity_balance,t.client_name=n.client_details.name.split(" ")[0],t.client_id=n.client_details.client_id,t.directSeenFlag=e.client_details.direct_notice_seen,t.directSeenFlag||(t.blur=!0),e.order_history.sort(function(e,t){return moment(t.ordered_at).toDate()-moment(e.ordered_at).toDate()}),t.loading=!1})):e.login(),e.generateCsv=function(e){for(var t="object"!=typeof e?JSON.parse(e):e,n="data:text/csv;charset=utf-8,",a="client_id,isin,scheme_name,plan,transaction_mode,trade_date,ordered_at,folio_number,amount,units,nav,status,remarks\r\n",r=["client_id","isin","name","plan","transaction_mode","trade_date","ordered_at","folio_number","amount","units","nav","status","remarks"],i=0;i<t.length;i++){for(var o="",s=0;s<r.length;s++)index=r[s],""!=o&&(o+=","),o+="transaction_mode"==index?"P"==t[i][index]?"BUY":"SELL":t[i][index]?t[i][index]:"";a+=o+"\r\n"}var l=encodeURI(n+a),c=document.createElement("a");c.setAttribute("href",l),c.setAttribute("download","coin_order_history.csv"),document.body.appendChild(c),c.click()}}]),app.controller("PartnerDashboardCtrl",["$scope","$rootScope","$cookies","PartnerService",function(e,t,n,a){console.log(t.partner_loggedIn),t.partner_loggedIn?(e.orders_overview=!0,a.dashboard(n.get("session_token")).then(function(t){200==t.status?(e.partner_data=t.data,e.partner_id=t.data.partner_id):alert("Something went wrong")})):window.location.replace(t.BASE_HOST+"logout"),e.switchPanel=function(t){1==t?(e.orders_overview=!0,e.settlement_wise=!1,e.client_details=!1):2==t?(e.orders_overview=!1,e.settlement_wise=!0,e.client_details=!1):3==t&&(e.orders_overview=!1,e.settlement_wise=!1,e.client_details=!0)}}]),app.controller("QuickLoginCtrl",["$scope","$rootScope","$location","$window","$route","$cookies",function(e,t,n,a,r,i){i.get("validated")?void 0!=n.search().redirect?(i.put("authRedirect",t.BASE_HOST+n.search().redirect),window.location.replace(t.BASE_HOST+n.search().redirect)):window.location.replace(t.BASE_HOST+"dashboard"):(void 0!=n.search().redirect?i.put("authRedirect",t.BASE_HOST+n.search().redirect):i.put("authRedirect",t.BASE_HOST+"dashboard"),window.location.replace("https://kite.trade/connect/login?api_key="+t.KITE_CONNECT_APIKEY))}]),app.controller("ScreenerCtrl",["$scope","$rootScope","utilService","$location","KiteAuthService","$cookies",function(e,t,n,a,r,i){function o(){t.loading=!0,e.currentPage=0,e.tableData=[];for(var n in e.fundList)for(var a in e.fundList[n])for(var r in e.fundList[n][a])e.tableData.push(e.fundList[n][a][r]);t.loading=!1,e.amcList=["All AMCs"],e.categoryList=["All categories"],e.categorySelected=e.categoryList[0];for(var n in e.fundList)e.amcList.push(n);e.amcList.sort()}e.fundList=screenerFullData,e.tableData=[],e.screenerOrderBy="category",e.portfolioReverseSort=!0,e.itemsPerPage=10,e.currentPage=0,e.numberOfPages=function(){return Math.ceil(e.tableData.length/e.itemsPerPage)},e.setPage=function(t){e.currentPage=t},e.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},o(),e.selectFund=function(e,t){redirect="/funds/"+e+"/"+n.generateSlug(t),a.url(redirect)},e.amcSelect=function(){if(e.currentPage=0,e.tableData=[],"All AMCs"==e.amcselected)o();else{e.categoryList=["All categories"];for(var t in e.fundList[e.amcselected])for(var n in e.fundList[e.amcselected][t])e.tableData.push(e.fundList[e.amcselected][t][n]);for(var t in e.fundList[e.amcselected])e.categoryList.push(t);e.categoryList.sort(),e.categorySelected=e.categoryList[0],console.log(e.categorySelected)}},e.categorySelect=function(){if(e.currentPage=0,e.tableData=[],"All categories"==e.categorySelected&&"All AMCs"!=e.amcselected)for(var t in e.fundList[e.amcselected])for(var n in e.fundList[e.amcselected][t])e.tableData.push(e.fundList[e.amcselected][t][n]);else if("All AMCs"!=e.amcselected)for(var t in e.fundList[e.amcselected][e.categorySelected])e.tableData.push(e.fundList[e.amcselected][e.categorySelected][t])},t.client_loggedIn===!0&&r.client_details(i.get("session_token")).then(function(e){t.client_id=e.data.client_details.client_id})}]),app.controller("SearchCtrl",["$scope","$rootScope","$cookies","$location","utilService","SearchService","mfService",function(e,t,n,a,r,i,o){e.searchFor="",e.showAutocomplete=!1,e.mutualFundList=autoCompleteData,e.searchFilter=function(){try{e.showAutocomplete=e.searchFor.length>0}catch(t){alert("Sorry unable to process.")}},e.mfSelected=function(t){e.searchFor=t.originalObject.name,e.code=t.originalObject.code;var n;n="Debt"==e.code||"Equity - Balanced Fund"==e.code||"Equity - Diversified"==e.code||"Equity - ELSS"==e.code||"Equity - Index"==e.code||"Equity - Sector Fund"==e.code||"Liquid"==e.code?"/category/"+e.code:"/funds/"+e.code+"/"+r.generateSlug(e.searchFor),a.url(n)},e.onMFHintSelect=function(t){e.searchFor=t.name,e.code=t.code;var n;n="Debt"==e.code||"Equity - Balanced Fund"==e.code||"Equity - Diversified"==e.code||"Equity - ELSS"==e.code||"Equity - Index"==e.code||"Equity - Sector Fund"==e.code||"Liquid"==e.code?"/category/"+t.code:"/funds/"+t.code+"/"+r.generateSlug(t.name),a.url(n)}}]),app.controller("SipCtrl",["$scope","$rootScope","$route","$routeParams","$location","mfService","SearchService","KiteAuthService","$window","DashboardDetails","OrderService","$cookies","$filter",function(e,t,n,a,r,i,o,s,l,c,d,u,_){e.sipEditModal=!1,e.deleteModal=!1,e.sipEditSteps=1,e.deleteStep=1,e.sipOrderBy="created_at",e.sipReverseSort=!0,e.SipFrequency=[{name:"Weekly",value:"Weekly"},{name:"15 days",value:"15-days"},{name:"Monthly",value:"Monthly"},{name:"Quarterly",value:"Quarterly"}],e.SipMonthDates=[{name:"Every 30 days",value:0},{name:"Every 1st",value:1},{name:"Every 5th",value:5},{name:"Every 10th",value:10},{name:"Every 15th",value:15},{name:"Every 20th",value:20},{name:"Every 25th",value:25}],e.sip_month_data=e.SipMonthDates[0].value;for(var p=[],m=0;m<31;m++)p.push(m);e.range=p,e.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.$watch("blur",function(){0==t.blur&&e.closeModal()}),e.closeModal=function(){e.sipEditModal=!1,e.sipEditSteps=1,e.deleteModal=!1,e.deleteStep=1,t.blur=!1},e.showSIPEdit=function(n,a,r,i,o,s,l,c,d,u,p,m,h,g){e.sipEditModal=!0,t.blur=!0,e.SipFundName=i,e.sip_invest_amount=o,e.sip_intervals_old=l,e.sip_intervals=l,e.total_intervals=c,e.SipOrderId=r,e.SipDivFlag=m,e.SipAmcCode=p,e.MinSipAmount=d,e.SipPurchaseMultiple=u,e.SipSchemeId=a,e.SipStatus=h,frequency_object=_("filter")(e.SipFrequency,function(e){return e.value===s})[0],e.sip_frequency_list=frequency_object.value,frequency_object=_("filter")(e.SipMonthDates,function(e){return e.value===g})[0],e.sip_month_data=frequency_object.value,e.sipEditSteps=1},e.processSIPEdit=function(n){1==n?(e.sip_intervals_old>e.sip_intervals?e.total_intervals=e.total_intervals-(e.sip_intervals_old-e.sip_intervals):e.total_intervals=e.total_intervals+(e.sip_intervals-e.sip_intervals_old),e.sip_edit_order={session_token:u.get("session_token"),scheme_id:e.SipSchemeId,sip_id:e.SipOrderId,transaction_amount:e.sip_invest_amount,bse_scheme_code:"",purchase_type:"SIP",dividend_status:e.SipDivFlag,frequency:e.sip_frequency_list,pending_intervals:e.sip_intervals,intervals:e.total_intervals,sip_month_data:e.sip_month_data},e.sipEditSteps=2):2==n&&(t.loading=!0,c.sipEdit(e.sip_edit_order).then(function(n){401==n.status?(s.logout(u.get("session_token")),e.login()):200==n.status?(e.sip_order_status=!0,c.sipDetails(u.get("session_token")).then(function(t){e.sip_details=e.getSIPData(t.data)})):e.sip_order_status=!1,t.loading=!1}),e.sipEditSteps=3)},e.showDeleteModal=function(n,a,r){e.deleteModal=!0,t.blur=!0,e.sip_delete_status=!1,1==r?(e.deleteBoxSchemeName=n,e.deleteSipID=a):2==r&&(e.sip_delete={session_token:u.get("session_token"),sip_id:e.deleteSipID,pending_intervals:0},c.sip_delete(e.sip_delete).then(function(t){401==t.status?(s.logout(u.get("session_token")),e.login()):200==t.status?c.sipDetails(u.get("session_token")).then(function(t){e.sip_details=e.getSIPData(t.data),e.sip_delete_status="Delete successful"}):e.sip_delete_status="Failed to delete"}),e.deleteStep=2)},e.statusChange=function(t,n){e.sip_statusChange={sip_id:t,session_token:u.get("session_token"),status:n},c.sip_status_update(e.sip_statusChange).then(function(t){401==t.status?(s.logout(u.get("session_token")),e.login()):200==t.status?c.sipDetails(u.get("session_token")).then(function(t){e.sip_details=e.getSIPData(t.data),e.sip_order_status=!0}):e.sip_order_status=!1})},e.getSIPData=function(e){for(var t=0;t<e.length;t++)0==e[t].preferred_date&&"Once"!=e[t].frequency?e[t].next_instalment=_("custom_date_add")(e[t].frequency,e[t].last_sip_at):0!=e[t].preferred_date&&"Once"!=e[t].frequency?e[t].next_instalment=_("custom_date_add")(e[t].preferred_date,e[t].last_sip_at):"Once"==e[t].frequency&&(e[t].next_instalment="N/A");return e},e.login=function(){l.sessionStorage.authRedirect=r.absUrl(),u.put("authRedirect",r.absUrl()),l.location.replace(t.BASE_HOST+"login")},t.client_loggedIn?(t.loading=!0,c.sipDetails(u.get("session_token")).then(function(n){401==n.status?(s.logout(u.get("session_token")),e.login()):200==n.status&&(e.sip_details=e.getSIPData(n.data),t.client_name=n.client_details.name.split(" ")[0],t.client_id=n.client_details.client_id,e.client_details=n.client_details,t.client_balance=e.client_details.equity_balance,t.directSeenFlag=e.client_details.direct_notice_seen,t.directSeenFlag||(t.blur=!0)),t.loading=!1})):e.login()}]),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define(["angular"],t):t(e.angular)}(window,function(e){e.module("angucomplete-alt",[]).directive("angucompleteAlt",["$q","$parse","$http","$sce","$timeout","$templateCache","$interpolate",function(e,t,n,a,r,i,o){function s(t,i,o,s){function w(e){ue=null,t.hideResults(e),document.body.removeEventListener("click",w)}function E(e){return e.which?e.which:e.keyCode}function F(e){"function"==typeof t.selectedObject?t.selectedObject(e):t.selectedObject=e,C(e?!0:!1)}function k(e){return function(n){return t[e]?t[e](n):n}}function R(e){F({originalObject:e}),t.clearSelected&&(t.searchStr=null),G()}function I(e){return t.titleField.split(",").map(function(t){return A(e,t)}).join(" ")}function A(e,t){var n,a;if(t){if(n=t.split("."),a=e)for(var r=0;r<n.length;r++)a=a[n[r]]}else a=e;return a}function D(e,n){var r,i;if(e){e.match&&e.replace||(e=e.toString());for(var o=n.split(" "),s=0;s<o.length;s++)keyword=o[s].replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp("("+keyword+")(?![^<]*>|[^<>]*</)","gmi"),r=e.match(i),e=r?e.replace(i,'<span class="'+t.matchClass+'">'+r[0]+"</span>"):e;return a.trustAsHtml(e)}}function C(e){t.notEmpty=e,se=t.searchStr,t.fieldRequired&&s&&s.$setValidity(oe,e)}function $(e){var n=E(e);if(n!==u&&n!==c)if(n===d||n===p)e.preventDefault();else if(n===l)e.preventDefault(),!t.showDropdown&&t.searchStr&&t.searchStr.length>=re&&(K(),t.searching=!0,z(t.searchStr));else if(n===_)G(),t.$apply(function(){ae.val(t.searchStr)});else{if(0===re&&!t.searchStr)return;t.searchStr&&""!==t.searchStr?t.searchStr.length>=re&&(K(),ie&&r.cancel(ie),t.searching=!0,ie=r(function(){z(t.searchStr)},t.pause)):t.showDropdown=!1,se&&se!==t.searchStr&&!t.clearSelected&&t.$apply(function(){F()})}}function P(e){!t.overrideSuggestions||t.selectedObject&&t.selectedObject.originalObject===t.searchStr||(e&&e.preventDefault(),R(t.searchStr))}function x(e){var t=getComputedStyle(e);return e.offsetHeight+parseInt(t.marginTop,10)+parseInt(t.marginBottom,10)}function M(){return ce.getBoundingClientRect().top+parseInt(getComputedStyle(ce).maxHeight,10)}function T(){return i[0].querySelectorAll(".angucomplete-row")[t.currentIndex]}function O(){return T().getBoundingClientRect().top-(ce.getBoundingClientRect().top+parseInt(getComputedStyle(ce).paddingTop,10))}function U(e){ce.scrollTop=ce.scrollTop+e}function L(){var e=t.results[t.currentIndex];t.matchClass?ae.val(I(e.originalObject)):ae.val(e.title)}function H(e){var n=E(e),a=null,r=null;n===p&&t.results?(t.currentIndex>=0&&t.currentIndex<t.results.length?(e.preventDefault(),t.selectResult(t.results[t.currentIndex])):(P(e),G()),t.$apply()):n===l&&t.results?(e.preventDefault(),t.currentIndex+1<t.results.length&&t.showDropdown&&(t.$apply(function(){t.currentIndex++,L()}),de&&(a=T(),M()<a.getBoundingClientRect().bottom&&U(x(a))))):n===d&&t.results?(e.preventDefault(),t.currentIndex>=1?(t.$apply(function(){t.currentIndex--,L()}),de&&(r=O(),r<0&&U(r-1))):0===t.currentIndex&&t.$apply(function(){t.currentIndex=-1,ae.val(t.searchStr)})):n===m&&(t.results&&t.results.length>0&&t.showDropdown?t.currentIndex===-1&&t.overrideSuggestions?P():(t.currentIndex===-1&&(t.currentIndex=0),t.selectResult(t.results[t.currentIndex]),t.$digest()):t.searchStr&&t.searchStr.length>0&&P())}function N(e){return function(n,a,r,i){a||r||i||(n=n.data),t.searching=!1,W(A(X(n),t.remoteUrlDataField),e)}}function q(e,n,a,r){n||a||r||(n=e.status),0!==n&&(t.remoteUrlErrorCallback?t.remoteUrlErrorCallback(e,n,a,r):console&&console.error&&console.error("http error"))}function B(){le&&le.resolve()}function V(a){var r={},i=t.remoteUrl+encodeURIComponent(a);t.remoteUrlRequestFormatter&&(r={params:t.remoteUrlRequestFormatter(a)},i=t.remoteUrl),t.remoteUrlRequestWithCredentials&&(r.withCredentials=!0),B(),le=e.defer(),r.timeout=le.promise,n.get(i,r).success(N(a)).error(q)}function j(n){B(),le=e.defer(),t.remoteApiHandler(n,le.promise).then(N(n))["catch"](q)}function G(){t.showDropdown=!1,t.results=[],ce&&(ce.scrollTop=0)}function K(){t.showDropdown=te,t.currentIndex=-1,t.results=[]}function Y(e){var n,a,r,i,o=t.searchFields.split(","),s=t.localData,l=[];if(e){e=e.replace(/^\s+|\s+$/g,"");for(var c=e.split(" "),d=0;d<c.length;d++){var u=c[d];for(u=u.replace(/^\s+|\s+$/g,""),n=0;n<s.length;n++){for(a=!1,r=0;r<o.length;r++)i=A(s[n],o[r])||"",a=a||i.toString().toLowerCase().indexOf(u.toString().toLowerCase())>=0;a&&(l[l.length]=s[n])}s=l,l=[]}t.searching=!1,W(s,e)}}function Z(e,n,a){if(a)for(var r in n)if(n[r].toLowerCase()===a.toLowerCase())return void t.selectResult(e)}function z(e){!e||e.length<re||(t.localData?t.$apply(function(){Y(e)}):t.remoteApiHandler?j(e):V(e))}function W(e,n){var a,r,i,o,s,l;if(e&&e.length>0){t.results=[];var c=20;for(e.length<c&&(c=e.length),a=0;a<c;a++)t.titleField&&""!==t.titleField&&(o=s=I(e[a])),r="",t.descriptionField&&(r=l=A(e[a],t.descriptionField)),i="",t.imageField&&(i=A(e[a],t.imageField)),t.matchClass&&(s=D(o,n),l=D(r,n)),t.results[t.results.length]={title:s,description:l,image:i,originalObject:e[a]},t.autoMatch&&Z(t.results[t.results.length-1],{title:o,desc:r||""},t.searchStr)}else t.results=[];0!==t.results.length||ne?t.showDropdown=!0:t.showDropdown=!1}function Q(){t.localData?W(t.localData,""):t.remoteApiHandler?j(""):V("")}var J,X,ee,te,ne,ae=i.find("input"),re=h,ie=null,oe=S,se=null,le=null,ce=i[0].querySelector(".angucomplete-dropdown"),de=!1,ue=null;i.on("mousedown",function(e){e.target.id?(ue=e.target.id,ue===t.id+"_dropdown"&&document.body.addEventListener("click",w)):ue=e.target.className}),t.currentIndex=null,t.searching=!1,ee=t.$watch("initialValue",function(e,n){e&&(ee(),"object"==typeof e?(t.searchStr=I(e),F({originalObject:e})):"string"==typeof e&&e.length>0?t.searchStr=e:console&&console.error&&console.error("Tried to set initial value of angucomplete to",e,"which is an invalid value"),C(!0))}),t.$on("angucomplete-alt:clearInput",function(e,n){n&&n!==t.id||(t.searchStr=null,F(),C(!1),G())}),t.onFocusHandler=function(){t.focusIn&&t.focusIn(),0!==re||t.searchStr&&0!==t.searchStr.length||(t.showDropdown=!0,Q())},t.hideResults=function(e){ue&&(ue===t.id+"_dropdown"||ue.indexOf("angucomplete")>=0)?ue=null:(J=r(function(){G(),t.$apply(function(){t.searchStr&&t.searchStr.length>0&&ae.val(t.searchStr)})},v),B(),t.focusOut&&t.focusOut(),t.overrideSuggestions&&t.searchStr&&t.searchStr.length>0&&t.currentIndex===-1&&P())},t.resetHideResults=function(){J&&r.cancel(J)},t.hoverRow=function(e){t.currentIndex=e},t.selectResult=function(e){t.matchClass&&(e.title=I(e.originalObject),e.description=A(e.originalObject,t.descriptionField)),t.clearSelected?t.searchStr=null:t.searchStr=e.title,F(e),G()},t.inputChangeHandler=function(e){return e.length<re?G():0===e.length&&0===re&&(t.searching=!1,Q()),t.inputChanged&&(e=t.inputChanged(e)),e},t.fieldRequiredClass&&""!==t.fieldRequiredClass&&(oe=t.fieldRequiredClass),t.minlength&&""!==t.minlength&&(re=parseInt(t.minlength,10)),t.pause||(t.pause=f),t.clearSelected||(t.clearSelected=!1),t.overrideSuggestions||(t.overrideSuggestions=!1),t.fieldRequired&&s&&C(t.initialValue?!0:!1),t.inputType=o.type?o.type:"text",t.textSearching=o.textSearching?o.textSearching:y,t.textNoResults=o.textNoResults?o.textNoResults:b,te="false"!==t.textSearching,ne="false"!==t.textNoResults,t.maxlength=o.maxlength?o.maxlength:g,ae.on("keydown",H),ae.on("keyup",$),X=k("remoteUrlResponseFormatter"),t.$on("$destroy",function(){C(!0)}),r(function(){var e=getComputedStyle(ce);de=e.maxHeight&&"auto"===e.overflowY})}var l=40,c=39,d=38,u=37,_=27,p=13,m=9,h=3,g=524288,f=500,v=200,S="autocomplete-required",y="Searching...",b="No results found",w="/angucomplete-alt/index.html";return i.put(w,'<div class="angucomplete-holder" ng-class="{\'angucomplete-dropdown-visible\': showDropdown}">  <input id="{{id}}_value" name="{{inputName}}" ng-class="{\'angucomplete-input-not-empty\': notEmpty}" ng-model="searchStr" ng-disabled="disableInput" type="{{inputType}}" placeholder="{{placeholder}}" maxlength="{{maxlength}}" ng-focus="onFocusHandler()" class="{{inputClass}}" ng-focus="resetHideResults()" ng-blur="hideResults($event)" autocapitalize="off" autocorrect="off" autocomplete="off" ng-change="inputChangeHandler(searchStr)"/>  <div id="{{id}}_dropdown" class="angucomplete-dropdown" ng-show="showDropdown">    <div class="angucomplete-searching" ng-show="searching" ng-bind="textSearching"></div>    <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"></div>    <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}">      <div ng-if="imageField" class="angucomplete-image-holder">        <img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="angucomplete-image"/>        <div ng-if="!result.image && result.image != \'\'" class="angucomplete-image-default"></div>      </div>      <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>      <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div>      <div ng-if="matchClass && result.description && result.description != \'\'" class="angucomplete-description" ng-bind-html="result.description"></div>      <div ng-if="!matchClass && result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}</div>    </div>  </div></div>'),{restrict:"EA",require:"^?form",scope:{selectedObject:"=",disableInput:"=",initialValue:"=",localData:"=",remoteUrlRequestFormatter:"=",remoteUrlRequestWithCredentials:"@",remoteUrlResponseFormatter:"=",remoteUrlErrorCallback:"=",remoteApiHandler:"=",id:"@",type:"@",placeholder:"@",remoteUrl:"@",remoteUrlDataField:"@",titleField:"@",descriptionField:"@",imageField:"@",inputClass:"@",pause:"@",searchFields:"@",minlength:"@",matchClass:"@",clearSelected:"@",overrideSuggestions:"@",fieldRequired:"@",fieldRequiredClass:"@",inputChanged:"=",autoMatch:"@",focusOut:"&",focusIn:"&",inputName:"@"},templateUrl:function(e,t){return t.templateUrl||w},compile:function(e,t){var n=o.startSymbol(),a=o.endSymbol();if("{{"!==n||"}}"!==a){var r=e.html().replace(/\{\{/g,n).replace(/\}\}/g,a);e.html(r)}return s}}}])}),app.directive("myDatachunk",function(){}),app.directive("datepicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var r=function(t){e.$apply(function(){a.$setViewValue(t)})},i={dateFormat:"mm/dd/yy",changeYear:!0,changeMonth:!0,maxDate:new Date,yearRange:"2010:+nn",onSelect:function(e){r(e)}};t.datepicker(i)}}}),app.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var r=e(a.fileModel),i=r.assign;n.bind("change",function(){t.$apply(function(){i(t,n[0].files[0])})})}}}]),app.directive("isNumber",function(){return{require:"ngModel",link:function(e){e.$watch("wks.number",function(t,n){var a=String(t).split("");0!==a.length&&(1!==a.length||"-"!=a[0]&&"."!==a[0])&&(2===a.length&&"-."===t||isNaN(t)&&(e.wks.number=n))})}}}),app.directive("myLinechart",["$window","$rootScope","$location",function(e,t,n){return{restrict:"EA",template:"<svg></svg>",scope:{graphdata:"="},link:function(a,r,i){var o,s=a.graphdata,l=e.d3,c=e.nv,d=i.xaxis,u=(i.ymax,l.select(r.find("svg")[0]));c.addGraph(function(){var e=n.path();return o=c.models.lineChart(),o.interpolate("basis-open"),"/"!=e&&"/home"!=e||o.showLegend(!1),o.xAxis.tickFormat(l.format(",f")),o.yAxis.tickFormat(l.format(",.2f")),o.useInteractiveGuideline(!0),o.yAxis.tickFormat(function(e,t){return l.round(e,2)}),"date"==d?o.xAxis.tickFormat(function(e){return l.time.format("%d %b %y")(new Date(e))}).showMaxMin(!1):"year"==d&&o.xAxis.tickFormat(function(e){return e}).showMaxMin(!1),u.datum(s).call(o),c.utils.windowResize(o.update),l.select(".nv-legendWrap").attr("transform","translate(0,-35)"),t.$on("graphDataChange",function(e,t,a){var r=n.path();"/"!=r&&"/home"!=r||o.forceY([Math.ceil(a),Math.ceil(t)]),l.select(".nv-legendWrap").attr("transform","translate(0,-35)"),o.update()}),t.chart=o,o})}}}]),app.directive("searchBoxGlobal",function(){return{restrict:"A",scope:{place:"="},templateUrl:"views/search.html"}}),app.directive("sipdatepicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var r=function(t){e.$apply(function(){a.$setViewValue(t)})},i={dateFormat:"mm/dd/yy",beforeShowDay:function(e){console.log(n.datelist),datelist=JSON.parse(n.datelist);var t="";return t+=("00"+e.getDate()).replace(/^0+/,""),[$.inArray(t,datelist)>=0,""]},onSelect:function(e){r(e)}};t.datepicker(i)}}}),!function(){"use strict";var e=angular.module("sticky",[]);e.directive("sticky",["$window","$timeout",function(e,t){return{restrict:"A",scope:{disabled:"=disabledSticky"},link:function(n,a,r){function i(){w=n.calculateStickyContentInitialDimensions(),U&&(a[0].getBoundingClientRect().height||(b=n.$watch(function(){return a.height()},function(e){e>0&&(w=n.calculateStickyContentInitialDimensions(),L||b())})))}function o(t){var n=s(E,t);return 1===n.length?n[0]:e}function s(e,t){var n,a=[],r=t.parent();do{var i=r[0];if(1!==i.nodeType)break;if(i.tagName.toUpperCase()===e.toUpperCase())return r;n=r.parent(),r=n}while(0!==n.length);return a}function l(t){return"true"===t&&e.innerHeight-(a[0].offsetHeight+parseInt(N))<0}function c(e,t,n){var a="top",r=Math.abs(e-t),i=Math.abs(e-n);return r>i&&(a="bottom"),a}function d(e){a.attr("style",q),k=!1,x.removeClass(A),a.removeClass(R),a.addClass(I),"top"===e?(a.removeClass(D),a.css("z-index",10).css("width",a[0].offsetWidth).css("top",w.top).css("position",w.position).css("left",w.cssLeft).css("margin-top",w.marginTop).css("height",w.height)):"bottom"===e&&O===!0&&(a.addClass(D),_(),a.css("z-index",10).css("width",a[0].offsetWidth).css("top","").css("bottom",0).css("position","absolute").css("left",w.cssLeft).css("margin-top",w.marginTop).css("margin-bottom",w.marginBottom).css("height",w.height)),S&&e===T&&S.remove()}function u(){k=!0,t(function(){w.offsetWidth=a[0].offsetWidth},0),x.addClass(A),a.removeClass(I),a.removeClass(D),a.addClass(R),_(),a.css("z-index","10").css("width",a[0].offsetWidth+"px").css("position","fixed").css("left",a.css("left").replace("px","")+"px").css(T,N+m(C)+"px").css("margin-top",0),"bottom"===T&&a.css("margin-bottom",0)}function _(){M&&(S&&S.remove(),S=angular.element("<div>"),S.css("height",a[0].offsetHeight+"px"),a.after(S))}function p(){return!!(O&&h()>F)}function m(e){var t=0;return e.getBoundingClientRect&&(t=e.getBoundingClientRect().top),t}function h(){var e;return e=void 0!==C.scrollTop?C.scrollTop:void 0!==C.pageYOffset?C.pageYOffset:document.documentElement.scrollTop}function g(){var t;return t=P[0]instanceof HTMLElement?e.getComputedStyle(P[0],null).getPropertyValue("height").replace(/px;?/,""):e.innerHeight,parseInt(t)||0}function f(){var t=r.mediaQuery||!1,n=e.matchMedia;return t&&!(n("("+t+")").matches||n(t).matches)}var v,S,y,b,w,E="sticky-scroll",F=0,k=!1,R=r.stickyClass||"",I=r.unstickyClass||"",A=r.bodyClass||"",D=r.bottomClass||"",C=o(a),$=angular.element(e),P=angular.element(C),x=angular.element(document.body),M="false"!==r.usePlaceholder,T="bottom"===r.anchor?"bottom":"top",O="true"===r.confine,U=void 0!==r.isStickyLayoutDeferred&&"true"===r.isStickyLayoutDeferred,L=void 0===r.isStickyLayoutWatched||"true"===r.isStickyLayoutWatched,H=a.css("position"),N=r.offset?parseInt(r.offset.replace(/px;?/,"")):0,q=a.attr("style")||"",B=function(){P.on("scroll",V),$.on("resize",n.$apply.bind(n,G)),i(),n.$on("$destroy",j)},V=function(){if((n.disabled===!0||f())&&k)return d();var e,t=h();e="top"===T?O===!0?t>v&&F>=t:t>v:v>=t;var i=c(t,v,F);!e||l(r.stickLimit)||k?!e&&k?d(i,t):O&&!e&&(y=m(a[0]),d(i,t)):u(i)},j=function(){P.off("scroll",V),$.off("resize",G),x.removeClass(A),S&&S.remove()},G=function(){d(T),V()},K=function(){return n.disabled===!0?d():"top"===T?(y||m(a[0]))-m(C)+h():m(a[0])-g()+a[0].offsetHeight+h()},Y=function(e,t){if(!(e===t&&void 0!==v||k||p())){v=e-N,O&&a.parent().css({position:"relative"});var n=a.parent()[0],r=parseInt(n.offsetHeight)-(M?0:a[0].offsetHeight),i=parseInt(a.css("margin-bottom").replace(/px;?/,""))||0,o=m(a[0]),s=m(n),l=m(C),c=o-l,d=s+r-o;F=c+d-a[0].offsetHeight-i-N+ +h(),V()}};n.$watch(K,Y),n.getElement=function(){return a},n.getScrollbar=function(){return C},n.getInitialCSS=function(){return w},n.getAnchor=function(){return T},n.isSticking=function(){return k},n.getOriginalInitialCSS=function(){return originalInitialCSS},n.processUnStickElement=function(e){d(e)},n.processCheckIfShouldStick=function(){V()},n.calculateStickyContentInitialDimensions=function(){return{zIndex:a.css("z-index"),top:a.css("top"),position:H,marginTop:a.css("margin-top"),marginBottom:a.css("margin-bottom"),cssLeft:a.css("left"),height:a.css("height")}},n.updateStickyContentUpdateDimensions=function(e,t){e&&t&&(w.width=e+"px",w.height=t+"px")},t(function(){n.calculateStickyContentInitialDimensions(),B()},0)},controller:["$scope","$window",function(e,t){this.resetLayout=function(n,a){function r(){"top"===s&&(i===t?t.scrollTo(0,0):i.scrollTop>0&&(i.scrollTop=0))}var i=e.getScrollbar(),o=e.getInitialCSS(),s=e.getAnchor();if(e.isSticking()&&(e.processUnStickElement(s),e.processCheckIfShouldStick()),e.getElement().css({width:"",height:"",position:"",top:"",zIndex:""}),o.position=e.getOriginalInitialCSS().position,delete o.offsetWidth,void 0===n&&void 0===a){var l=e.getElement()[0].getBoundingClientRect();n=l.width,a=l.height}e.updateStickyContentUpdateDimensions(n,a),r()},this.getScrollbar=function(){return e.getScrollbar()}}]}}]),window.matchMedia=window.matchMedia||function(){var e="angular-sticky: This browser does not support matchMedia, therefore the minWidth option will not work on this browser. Polyfill matchMedia to fix this issue.";return window.console&&console.warn&&console.warn(e),function(){return{matches:!0}}}()}(),app.factory("HTTPFactory",["$http","$window","$rootScope","$q",function(e,t,n,a){function r(e){var a=null;return 401==e.status?t.location.replace(n.BASE_HOST+"logout"):(a={status:e.status,data:e.data.data},e.data.client_details&&(a.client_details=e.data.client_details),
e.data.message&&(a.message=e.data.message)),a}var i,o={};return e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",o.postAndGetResults=function(t,a){return e.defaults.transformRequest=[function(e){return angular.isObject(e)&&String(e)!==a?$.param(e):e}],i=e.post(t,a).then(function(e){return r(e)},function(e){return 502==e.status&&(n.ServerStatus=!1,n.blur=!1),r(e)})},o.getInfo=function(t,a){return n.loading||(n.loading=!0),e({method:"GET",url:t,params:a}).then(function(e){return r(e)},function(e){return 502==e.status&&(n.ServerStatus=!1,n.blur=!1),r(e)})},o.getData=function(t){return e.get(t)},o}]),app.filter("custom_date",function(){return function(e){return formatted_date=moment(e).toDate(),isNaN(formatted_date)?"N/A":("0"+formatted_date.getDate()).slice(-2)+"-"+("0"+(formatted_date.getMonth()+1)).slice(-2)+"-"+formatted_date.getFullYear()}}),app.filter("custom_date_text",function(){return function(e){return formatted_date=moment(e).toDate(),moment(formatted_date).format("DD MMM YYYY")}}),app.filter("custom_date_add",function(){return function(e,t){return formatted_date=moment(t).toDate(),"Once"==e?"N/A":("Weekly"==e?(next_date=new Date(formatted_date.getTime()+6048e5),today=moment().toDate(),moment().isAfter(next_date)&&(next_date=new Date(today.getTime()+864e5))):"Monthly"==e?(next_date=new Date(formatted_date.getTime()+2592e6),today=moment().toDate(),moment().isAfter(next_date)&&(next_date=new Date(today.getTime()+864e5))):"Quarterly"==e?(next_date=new Date(formatted_date.getTime()+7776e6),today=moment().toDate(),moment().isAfter(next_date)&&(next_date=new Date(today.getTime()+864e5))):"15-days"==e?(next_date=new Date(formatted_date.getTime()+1296e6),today=moment().toDate(),moment().isAfter(next_date)&&(next_date=new Date(today.getTime()+864e5))):0!=e&&(day=e,today=moment().date(),month=moment().month(),year=moment().year(),day<today?11==month?future=moment().month(0).date(day).year(year+1):future=moment().month(month+1).date(day).year(year):future=moment().date(day),next_date=new Date(future)),next_date)}}),app.filter("days_from_now",function(){return function(e){return a=moment(e),b=moment(),b.diff(a,"days")}}),app.filter("kformat",function(){return function(e){var t,n=[{value:1e7,symbol:"Cr"},{value:1e5,symbol:"L"},{value:1e3,symbol:"k"}];for(t=0;t<n.length;t++)if(e>=n[t].value)return(Math.floor(e/n[t].value*100)/100).toFixed(2).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+n[t].symbol;return e.toFixed(2)}}),app.filter("number_suffix",function(){return function(e){var t=e%10,n=e%100;return 1==t&&11!=n?e+"st":2==t&&12!=n?e+"nd":3==t&&13!=n?e+"rd":e+"th"}}),app.filter("number_inr",function(){return function(e){if(void 0===e||null===e)return 0;var t=parseFloat(e);t=Math.round(100*t)/100,e=t+"",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var n=/(\d+)(\d{3})/,a=0,r=String(x1).length,i=parseInt(r/2-1);n.test(x1)&&(a>0?x1=x1.replace(n,"$1,$2"):(x1=x1.replace(n,"$1,$2"),n=/(\d+)(\d{2})/),a++,i--,0!=i););return x1+x2}}),app.filter("pagination",function(){return function(e,t){return t=+t,e.slice(t)}}),app.filter("sumOfValue",function(){return function(e,t){if(angular.isUndefined(e)&&angular.isUndefined(t))return 0;var n=0;return angular.forEach(e,function(e,a){n+=parseFloat(e[t])}),n}});
